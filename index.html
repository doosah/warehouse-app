<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞</title>
    <style>
/* ========== –°–û–í–†–ï–ú–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù: –¢–æ–ª—å–∫–æ —Ü–≤–µ—Ç–∞, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã ========== */
:root {
    --primary-color: #667eea;
    --primary-dark: #764ba2;
    --secondary-color: #f093fb;
    --accent-color: #4facfe;
    --success-color: #43e97b;
    --error-color: #fa709a;
    --bg-dark: #0a0e27;
    --bg-darker: #1a1f3a;
    --bg-container: rgba(10, 14, 39, 0.85);
    --text-primary: #f0f4ff;
    --text-secondary: #c8d2e8;
    --border-color: rgba(135, 150, 200, 0.25);
}
body {
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2d1b3d 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    color: var(--text-primary);
    margin: 0;
    padding: 20px;
    font-family: system-ui, -apple-system, sans-serif;
}
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2d1b3d 100%);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6), 
                0 1px 0 rgba(255, 255, 255, 0.05);
    padding: 20px;
    border-radius: 16px;
}
.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-size: 200% 200%;
    animation: gradientFlow 8s ease infinite;
    color: white;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    border-radius: 12px;
}
.header-inner {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}
.logo {
    height: 40px;
    width: auto;
    filter: drop-shadow(0 2px 8px rgba(102, 126, 234, .45));
    transition: transform 0.3s ease;
}
.logo:hover {
    transform: scale(1.05);
}
@media (max-width: 480px) {
    .logo { height: 32px; }
    .header-inner { flex-direction: column; align-items: flex-start; }
}
@keyframes gradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
h1 {
    color: #ffffff;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
    margin: 0;
    font-size: 1.5em;
}
.subtitle {
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9em;
    margin-top: 4px;
}
.section {
    display: none;
}
.section.active {
    display: block;
}
.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 16px;
    margin-bottom: 16px;
}
.large-button, .secondary {
    padding: 12px 20px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
.large-button {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    flex: 1;
    min-width: 200px;
}
.secondary {
    background: rgba(106, 137, 204, 0.15);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}
.large-button:hover, .secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.category-block {
    margin: 16px 0;
    padding: 12px;
    background: rgba(30, 35, 60, 0.6);
    border-radius: 10px;
}
.input-row {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}
.plan-input, .fact-input, .time-input, .single-input, .select-input {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: rgba(10, 14, 39, 0.7);
    color: var(--text-primary);
    width: 100%;
}
.delta {
    margin-top: 6px;
    color: var(--success-color);
    font-weight: bold;
}
.yesno-buttons {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}
.yes-btn, .no-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
.yes-btn { background: var(--success-color); color: #000; }
.no-btn { background: var(--error-color); color: #000; }
.yes-btn.active, .no-btn.active {
    transform: scale(1.05);
    box-shadow: 0 0 8px rgba(255,255,255,0.5);
}
.warehouse-btn {
    display: block;
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    background: rgba(106, 137, 204, 0.1);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
}
.warehouse-btn:hover {
    background: rgba(106, 137, 204, 0.25);
}
.date-section {
    margin: 20px 0;
}
.calendar-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 10px 0;
}
.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-top: 10px;
}
.calendar-header {
    text-align: center;
    font-weight: bold;
    color: #a0b0d0;
    padding: 6px;
}
.date-btn {
    background: rgba(106, 137, 204, 0.2);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 6px;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
}
.date-btn.selected {
    background: var(--primary-color);
    color: white;
}
.selected-date-display {
    margin-top: 10px;
    text-align: center;
    font-weight: bold;
    color: #c7d2fe;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
    background: rgba(10, 14, 39, 0.7);
    border-radius: 10px;
    overflow: hidden;
}
th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}
th {
    background: rgba(106, 137, 204, 0.2);
    color: #c7d2fe;
}
tr:last-child td {
    border-bottom: none;
}
.full-screen-table {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--bg-dark);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    padding: 20px;
    overflow: auto;
}
.close-full {
    align-self: flex-end;
    background: var(--error-color);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 20px;
}
.checkbox-group, .radio-group {
    display: flex;
    gap: 20px;
    margin: 16px 0;
    flex-wrap: wrap;
}
.checkbox-group label, .radio-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
}
.filter-section {
    margin: 16px 0;
}
.filter-section select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: rgba(10, 14, 39, 0.7);
    color: var(--text-primary);
}
#console-output {
    display: none;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-inner">
                <img src="image.png" alt="W V3LS3N" class="logo">
                <div class="header-text">
                    <h1>üìä –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
                    <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
            </div>
        </div>
        
        <div id="mainSection" class="section active">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞</h2>
            <div class="action-buttons">
                <button class="large-button" onclick="selectReport('operational')">üìÑ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</button>
                <button class="large-button" onclick="selectReport('personnel')">üìä –û—Ç—á–µ—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</button>
            </div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="secondary" onclick="fillTestData()">‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø–µ—Ä–∞—Ü–∏–∏)</button>
                <button class="secondary" onclick="fillPersonnelTestData()">‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä—Å–æ–Ω–∞–ª)</button>
            </div>
        </div>
        
        <div id="warehouseReportSection" class="section">
            <h2 id="warehouseTitle">–û—Ç—á—ë—Ç –ø–æ —Å–∫–ª–∞–¥—É</h2>
            <div class="warehouse-list" id="warehouseList"></div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriod()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarView()"><span id="warehouseViewToggleText">üìÖ –ù–µ–¥–µ–ª—è</span></button>
                    <button class="secondary" onclick="nextPeriod()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="warehouseCalendar" class="calendar"></div>
                <div id="selectedWarehouseDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group">
                <label><input type="radio" name="warehouseReportType" value="day" checked onchange="loadCategoryInputs()"> ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</label>
                <label><input type="radio" name="warehouseReportType" value="night" onchange="loadCategoryInputs()"> üåô –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</label>
            </div>
            <form id="reportForm">
                <div id="categoryInputs"></div>
                <div class="action-buttons">
                    <button type="button" onclick="saveWarehouseReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                    <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
                </div>
            </form>
        </div>

        <div id="personnelReportSection" class="section">
            <h2 id="personnelTitle">–û—Ç—á—ë—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="warehouse-list" id="personnelList"></div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodPersonnel()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarViewPersonnel()"><span id="personnelViewToggleText">üìÖ –ù–µ–¥–µ–ª—è</span></button>
                    <button class="secondary" onclick="nextPeriodPersonnel()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="personnelCalendar" class="calendar"></div>
                <div id="selectedPersonnelDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group">
                <label><input type="radio" name="personnelReportType" value="day" checked onchange="loadPersonnelCategoryInputs()"> ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</label>
                <label><input type="radio" name="personnelReportType" value="night" onchange="loadPersonnelCategoryInputs()"> üåô –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</label>
            </div>
            <form id="personnelReportForm">
                <div id="personnelCategoryInputs"></div>
                <div class="action-buttons">
                    <button type="button" onclick="savePersonnelReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                    <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
                </div>
            </form>
        </div>

        <div id="summarySection" class="section">
            <h2>üìä –û–±—â–∏–π —Å–≤–æ–¥ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="summaryDay" checked onchange="updateSummaryTable()"> ‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ —Å–º–µ–Ω—ã</label>
                <label><input type="checkbox" id="summaryNight" onchange="updateSummaryTable()"> üåô –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã</label>
            </div>
            <div class="filter-section">
                <h4>üë§ –§–∏–ª—å—Ç—Ä –ø–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é</h4>
                <select id="managerFilter" onchange="updateSummaryTable()">
                    <option value="">–í—Å–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.</option>
                </select>
            </div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodSummary()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <span id="summaryDateDisplay"></span>
                    <button class="secondary" onclick="nextPeriodSummary()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="showSummaryData()">üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
            </div>
        </div>

        <div id="summaryTableSection" class="section">
            <h2>üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
            <div class="date-section">
                <div style="display:flex;flex-direction:column;gap:10px">
                    <button class="secondary" onclick="prevSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <div id="currentSummaryDate" style="text-align:center;font-size:clamp(16px,4vw,18px);font-weight:600;color:#c7d2fe;padding:10px"></div>
                    <button class="secondary" onclick="nextSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div id="summaryTable"></div>
            <div class="action-buttons">
                <button onclick="toggleFullScreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                <button class="secondary" onclick="showSummarySection()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <div id="personnelSummarySection" class="section">
            <h2>üìä –°–≤–æ–¥ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="personnelSummaryDay" checked onchange="updatePersonnelSummaryTable()"> ‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ —Å–º–µ–Ω—ã</label>
                <label><input type="checkbox" id="personnelSummaryNight" onchange="updatePersonnelSummaryTable()"> üåô –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã</label>
            </div>
            <div class="filter-section">
                <h4>üë§ –§–∏–ª—å—Ç—Ä –ø–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é</h4>
                <select id="personnelManagerFilter" onchange="updatePersonnelSummaryTable()">
                    <option value="">–í—Å–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.</option>
                </select>
            </div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPersonnelSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <span id="personnelSummaryDateDisplay"></span>
                    <button class="secondary" onclick="nextPersonnelSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="showPersonnelSummaryData()">üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
            </div>
        </div>

        <div id="personnelSummaryTableSection" class="section">
            <h2>üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="date-section">
                <div style="display:flex;flex-direction:column;gap:10px">
                    <button class="secondary" onclick="prevPersonnelSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <div id="currentPersonnelSummaryDate" style="text-align:center;font-size:clamp(16px,4vw,18px);font-weight:600;color:#c7d2fe;padding:10px"></div>
                    <button class="secondary" onclick="nextPersonnelSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div id="personnelSummaryTable"></div>
            <div class="action-buttons">
                <button onclick="togglePersonnelFullScreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                <button class="secondary" onclick="showPersonnelSummarySection()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <div id="fullScreenTable" class="full-screen-table" style="display:none">
            <button class="close-full" onclick="toggleFullScreen()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            <div id="fullSummaryTable"></div>
        </div>
        <div id="psFullScreen" class="full-screen-table" style="display:none">
            <button class="close-full" onclick="togglePersonnelFullScreen()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            <div id="psFullTable"></div>
        </div>

        <div id="console-output"></div>
    </div>

    <script>
        const WAREHOUSES = [
            "–ê–†–•–ê–ù–ì–ï–õ–¨–°–ö_–•–ê–ë_–ù–ê–•–ò–ú–û–í–ê","–ú–£–†–ú–ê–ù–°–ö_–•–ê–ë_–û–ë–™–ï–ó–î–ù–ê–Ø","–í–ï–õ–ò–ö–ò–ô_–ù–û–í–ì–û–†–û–î_–•–ê–ë_–ù–ï–•–ò–ù–°–ö–ê–Ø",
            "–ü–ï–¢–†–û–ó–ê–í–û–î–°–ö_–•–ê–ë_–ü–†–Ø–ñ–ò–ù–°–ö–û–ï","–ü–°–ö–û–í_–•–ê–ë_–ú–ê–†–ì–ï–õ–û–í–ê","–ü–°–ö–û–í_–•–ê–ë_–ù–û–í–´–ô",
            "–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–õ–ï–°–û–ü–ê–†–ö–û–í–ê–Ø","–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–û–ö–¢–Ø–ë–†–¨–°–ö–ò–ô","–ß–ï–†–ï–ü–û–í–ï–¶_–•–ê–ë_–°–¢–†–û–ô–ò–ù–î–£–°–¢–†–ò–ò","–í–û–õ–û–ì–î–ê_–•–ê–ë_–ë–ï–õ–û–ó–ï–†–°–ö–û–ï"
        ];
        const CATEGORIES = [
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞', type: 'number'},
            {name: '–ü–µ—Ä—Å–æ–Ω–∞–ª', type: 'number'},
            {name: '–û–∫–æ–Ω—á–∞–Ω–∏–µ –≤—ã–¥–∞—á–∏', type: 'time'},
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞ FBS', type: 'number'},
            {name: '–í–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –ø–æ—Ç–æ–∫ (–ë—ç–∫–ª–æ–≥)', type: 'number'},
            {name: '–û–±–µ–∑–ª–∏—á–∫–∞', type: 'single', label: '–ü–æ–¥–¥–æ–Ω—ã', unit: '—à—Ç'},
            {name: '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', type: 'number'},
            {name: '–ö–æ–ª-–≤–æ –ø–∞–ª–ª–µ—Ç–∞-–º–µ—Å—Ç –∫ –æ—Ç–≥—Ä—É–∑–∫–µ', type: 'triple',
             fields: [{n: 'FBS', u: '—à—Ç'}, {n: 'X-Dock', u: '—à—Ç'}, {n: '–í–æ–∑–≤—Ä–∞—Ç—ã', u: '—à—Ç'}]},
            {name: '–•—Ä–æ–Ω—å –•–î', type: 'double',
             fields: [{n: '–°–æ—Ä—Ç', u: '—à—Ç'}, {n: '–ù–æ–Ω-–°–æ—Ä—Ç', u: '—à—Ç'}]},
            {name: '–†–∏—Å–∫–∏', type: 'yesno'},
            {name: '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –í—ã–¥–∞—á–∞', type: 'single', label: '–ó–Ω–∞—á–µ–Ω–∏–µ', unit: '—à—Ç'},
            {name: '% –Ω–µ –ø—Ä–æ—Ñ–∏–ª—è', type: 'single', label: '–ü—Ä–æ—Ü–µ–Ω—Ç', unit: '%'},
            {name: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', type: 'select', options: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.']}
        ];
        let reports = JSON.parse(localStorage.getItem('warehouseReports')) || {};
        let currentDate = new Date();
        let warehouseCalendarView = 'week';
        let selectedWarehouseDate = null;
        let currentWarehouse = '';
        let selectedSummaryDate = new Date();

        const PERSONNEL_OBJECTS = ["–û—Ç–¥–µ–ª 1", "–û—Ç–¥–µ–ª 2", "–û—Ç–¥–µ–ª 3", "–û—Ç–¥–µ–ª 4"];
        const PERSONNEL_CATEGORIES = [
            {name: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', type: 'number'},
            {name: '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤', type: 'number'},
            {name: '–ü—Ä–æ–ø—É—Å–∫–∏', type: 'number'},
            {name: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', type: 'select', options: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.']}
        ];
        let personnelReports = JSON.parse(localStorage.getItem('personnelReports')) || {};
        let currentPersonnelObj = '';
        let selectedPersonnelDate = null;
        let personnelCalendarView = 'week';

        function cleanOldReports() {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const keysToDelete = Object.keys(reports).filter(dateStr => {
                try {
                    const [day, month, year] = dateStr.split('.').map(Number);
                    const reportDate = new Date(year, month - 1, day);
                    return reportDate < sixMonthsAgo;
                } catch (e) {
                    return true;
                }
            });
            keysToDelete.forEach(key => delete reports[key]);
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
        }
        function cleanOldPersonnelReports() {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const keysToDelete = Object.keys(personnelReports).filter(dateStr => {
                try {
                    const [day, month, year] = dateStr.split('.').map(Number);
                    const reportDate = new Date(year, month - 1, day);
                    return reportDate < sixMonthsAgo;
                } catch (e) {
                    return true;
                }
            });
            keysToDelete.forEach(key => delete personnelReports[key]);
            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
        }

        function generateWarehouseList() {
            const list = document.getElementById('warehouseList');
            list.innerHTML = WAREHOUSES.map(wh => `
                <button class="warehouse-btn" onclick="showWarehouseReport('${wh}')">${wh}</button>
            `).join('');
        }
        function generatePersonnelList() {
            const list = document.getElementById('personnelList');
            list.innerHTML = PERSONNEL_OBJECTS.map(obj => `
                <button class="warehouse-btn" onclick="showPersonnelReport('${obj}')">${obj}</button>
            `).join('');
        }

        function renderCalendar(calendarId, viewMode, onSelect, refDate = new Date()) {
            const cal = document.getElementById(calendarId);
            const referenceDate = new Date(refDate);
            const daysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            
            cal.innerHTML = daysOfWeek.map(day => `
                <div class="calendar-header">${day}</div>
            `).join('');

            const dates = [];
            if (viewMode === 'week') {
                const startDay = new Date(referenceDate);
                startDay.setDate(referenceDate.getDate() - ((referenceDate.getDay() || 7) - 1));
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startDay);
                    d.setDate(startDay.getDate() + i);
                    dates.push(d);
                }
            } else {
                const year = referenceDate.getFullYear();
                const month = referenceDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    dates.push(new Date(year, month, day));
                }
            }

            cal.innerHTML += dates.map(date => {
                const isToday = date.toDateString() === new Date().toDateString();
                const isSelected = selectedWarehouseDate && date.toLocaleDateString('ru-RU') === selectedWarehouseDate;
                return `
                    <button class="date-btn ${isSelected ? 'selected' : ''}" 
                            onclick="onSelectDate(${JSON.stringify(date.toDateString())}, '${calendarId}')">
                        ${date.getDate()}
                    </button>
                `;
            }).join('');
        }

        function onSelectDate(dateStr, calendarId) {
            const date = new Date(dateStr);
            const ruDate = date.toLocaleDateString('ru-RU');
            if (calendarId === 'warehouseCalendar') {
                selectedWarehouseDate = ruDate;
                document.getElementById('selectedWarehouseDate').textContent = `–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞: ${selectedWarehouseDate}`;
                loadCategoryInputs();
            } else if (calendarId === 'personnelCalendar') {
                selectedPersonnelDate = ruDate;
                document.getElementById('selectedPersonnelDate').textContent = `–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞: ${selectedPersonnelDate}`;
                loadPersonnelCategoryInputs();
            }
        }

        function renderWarehouseCalendar() {
            renderCalendar('warehouseCalendar', warehouseCalendarView, null, currentDate);
            document.getElementById('warehouseViewToggleText').textContent = 
                warehouseCalendarView === 'week' ? 'üìÖ –ù–µ–¥–µ–ª—è' : 'üìÜ –ú–µ—Å—è—Ü';
        }
        function renderPersonnelCalendar() {
            renderCalendar('personnelCalendar', personnelCalendarView, null, currentDate);
            document.getElementById('personnelViewToggleText').textContent = 
                personnelCalendarView === 'week' ? 'üìÖ –ù–µ–¥–µ–ª—è' : 'üìÜ –ú–µ—Å—è—Ü';
        }

        function prevPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderWarehouseCalendar();
        }
        function nextPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderWarehouseCalendar();
        }
        function toggleCalendarView() {
            warehouseCalendarView = warehouseCalendarView === 'week' ? 'month' : 'week';
            renderWarehouseCalendar();
        }

        function prevPeriodPersonnel() {
            if (personnelCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderPersonnelCalendar();
        }
        function nextPeriodPersonnel() {
            if (personnelCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderPersonnelCalendar();
        }
        function toggleCalendarViewPersonnel() {
            personnelCalendarView = personnelCalendarView === 'week' ? 'month' : 'week';
            renderPersonnelCalendar();
        }

        // Summary date navigation (simplified to day-by-day)
        function prevPeriodSummary() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() - 1);
            updateSummaryDateDisplay();
        }
        function nextPeriodSummary() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() + 1);
            updateSummaryDateDisplay();
        }
        function updateSummaryDateDisplay() {
            document.getElementById('summaryDateDisplay').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
        }

        function prevPersonnelSummaryDay() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() - 1);
            document.getElementById('currentPersonnelSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
        }
        function nextPersonnelSummaryDay() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() + 1);
            document.getElementById('currentPersonnelSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
        }

        function selectReport(reportType) {
            document.querySelector('.section.active')?.classList.remove('active');
            currentDate = new Date();
            switch (reportType) {
                case 'operational':
                    generateWarehouseList();
                    showWarehouseReport(WAREHOUSES[0]);
                    break;
                case 'personnel':
                    generatePersonnelList();
                    showPersonnelReport(PERSONNEL_OBJECTS[0]);
                    break;
            }
        }

        function showWarehouseReport(wh) {
            currentWarehouse = wh;
            document.getElementById('warehouseTitle').textContent = `üìç –°–∫–ª–∞–¥: ${wh}`;
            document.getElementById('warehouseReportSection').classList.add('active');
            selectedWarehouseDate = currentDate.toLocaleDateString('ru-RU');
            document.getElementById('selectedWarehouseDate').textContent = `–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞: ${selectedWarehouseDate}`;
            renderWarehouseCalendar();
            loadCategoryInputs();
        }

        function showPersonnelReport(obj) {
            currentPersonnelObj = obj;
            document.getElementById('personnelTitle').textContent = `üìç –û–±—ä–µ–∫—Ç: ${obj}`;
            document.getElementById('personnelReportSection').classList.add('active');
            selectedPersonnelDate = currentDate.toLocaleDateString('ru-RU');
            document.getElementById('selectedPersonnelDate').textContent = `–í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞: ${selectedPersonnelDate}`;
            renderPersonnelCalendar();
            loadPersonnelCategoryInputs();
        }

        function backToMain() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('mainSection').classList.add('active');
            currentDate = new Date();
            currentWarehouse = currentPersonnelObj = '';
            selectedWarehouseDate = selectedPersonnelDate = null;
            selectedSummaryDate = new Date();
        }

        function fillTestData() {
            const testDates = Array.from({length: 5}, (_, i) => new Date(Date.now() - i*86400000).toLocaleDateString('ru-RU'));
            WAREHOUSES.forEach(wh => {
                testDates.forEach(date => {
                    if (!reports[date]) reports[date] = {};
                    const dayData = {
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞': { plan: Math.floor(Math.random()*100), fact: Math.floor(Math.random()*100) },
                        '–ü–µ—Ä—Å–æ–Ω–∞–ª': { plan: Math.floor(Math.random()*20), fact: Math.floor(Math.random()*20) },
                        '–û–∫–æ–Ω—á–∞–Ω–∏–µ –≤—ã–¥–∞—á–∏': { plan: '12:00', fact: '12:' + Math.floor(Math.random()*60).toString().padStart(2,'0') },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: CATEGORIES.find(c => c.name === '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å').options[Math.floor(Math.random()*2)] }
                    };
                    reports[date][wh] = { 
                        day: dayData, 
                        night: {...dayData, '–û–±—Ä–∞–±–æ—Ç–∫–∞': { plan: dayData.–û–±—Ä–∞–±–æ—Ç–∫–∞.plan/2, fact: dayData.–û–±—Ä–∞–±–æ—Ç–∫–∞.fact/2 }}
                    };
                });
            });
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
        }

        function fillPersonnelTestData() {
            const testDates = Array.from({length: 5}, (_, i) => new Date(Date.now() - i*86400000).toLocaleDateString('ru-RU'));
            PERSONNEL_OBJECTS.forEach(obj => {
                testDates.forEach(date => {
                    if (!personnelReports[date]) personnelReports[date] = {};
                    const dayData = {
                        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤': { plan: 20, fact: 20 + Math.floor(Math.random()*5) },
                        '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤': { plan: 8, fact: 8 },
                        '–ü—Ä–æ–ø—É—Å–∫–∏': { plan: 0, fact: Math.floor(Math.random()*2) },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: PERSONNEL_CATEGORIES[3].options[Math.floor(Math.random()*2)] }
                    };
                    personnelReports[date][obj] = { 
                        day: dayData, 
                        night: {...dayData, '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤': { plan: 10, fact: 10 + Math.floor(Math.random()*3) }}
                    };
                });
            });
            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
        }

        function setYesNo(category, value) {
            const blocks = document.querySelectorAll(`#categoryInputs .category-block.yesno`);
            blocks.forEach(block => {
                if (block.querySelector('h4').textContent === category) {
                    block.dataset.yesnoValue = value;
                    block.querySelectorAll('.yes-btn, .no-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    if (value === 'yes') {
                        block.querySelector('.yes-btn').classList.add('active');
                    } else {
                        block.querySelector('.no-btn').classList.add('active');
                    }
                }
            });
        }

        function loadCategoryInputs() {
            if (!selectedWarehouseDate || !currentWarehouse) return;
            const type = document.querySelector('input[name="warehouseReportType"]:checked').value;
            const categoryDiv = document.getElementById('categoryInputs');
            categoryDiv.innerHTML = CATEGORIES.map(cat => {
                const data = reports[selectedWarehouseDate]?.[currentWarehouse]?.[type]?.[cat.name] || {};
                let inputHtml = `<div class="category-block ${cat.type}">
                    <h4>${cat.name}</h4>`;
                
                if (cat.type === 'number') {
                    inputHtml += `
                        <div class="input-row">
                            <input type="number" class="plan-input" placeholder="–ü–ª–∞–Ω" value="${data.plan || ''}">
                            <input type="number" class="fact-input" placeholder="–§–∞–∫—Ç" value="${data.fact || ''}">
                        </div>
                        <div class="delta">${typeof data.delta !== 'undefined' ? data.delta : '-'}</div>
                    `;
                } else if (cat.type === 'time') {
                    inputHtml += `
                        <div class="input-row">
                            <input type="text" class="time-input" placeholder="–ü–ª–∞–Ω (–ß–ß:–ú–ú)" value="${data.plan || ''}">
                            <input type="text" class="time-input" placeholder="–§–∞–∫—Ç (–ß–ß:–ú–ú)" value="${data.fact || ''}">
                        </div>
                        <div class="delta">${data.delta || '-'}</div>
                    `;
                } else if (cat.type === 'single') {
                    inputHtml += `
                        <input type="number" class="single-input" placeholder="${cat.label}" value="${data.value || ''}">
                        <div>–ï–¥–∏–Ω–∏—Ü–∞: ${cat.unit}</div>
                    `;
                } else if (cat.type === 'yesno') {
                    const activeYes = data.value === 'yes' ? 'active' : '';
                    const activeNo = data.value === 'no' ? 'active' : '';
                    inputHtml += `
                        <div class="yesno-buttons">
                            <button class="yes-btn ${activeYes}" onclick="setYesNo('${cat.name}','yes')">–î–∞</button>
                            <button class="no-btn ${activeNo}" onclick="setYesNo('${cat.name}','no')">–ù–µ—Ç</button>
                        </div>
                    `;
                } else if (cat.type === 'select') {
                    inputHtml += `
                        <select class="select-input">
                            <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                            ${cat.options.map(opt => `<option value="${opt}" ${data.value === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    `;
                }
                return inputHtml + '</div>';
            }).join('');
        }

        function loadPersonnelCategoryInputs() {
            if (!selectedPersonnelDate || !currentPersonnelObj) return;
            const type = document.querySelector('input[name="personnelReportType"]:checked').value;
            const categoryDiv = document.getElementById('personnelCategoryInputs');
            categoryDiv.innerHTML = PERSONNEL_CATEGORIES.map(cat => {
                const data = personnelReports[selectedPersonnelDate]?.[currentPersonnelObj]?.[type]?.[cat.name] || {};
                let inputHtml = `<div class="category-block ${cat.type}">
                    <h4>${cat.name}</h4>`;
                
                if (cat.type === 'number') {
                    inputHtml += `
                        <div class="input-row">
                            <input type="number" class="plan-input" placeholder="–ü–ª–∞–Ω" value="${data.plan || ''}">
                            <input type="number" class="fact-input" placeholder="–§–∞–∫—Ç" value="${data.fact || ''}">
                        </div>
                        <div class="delta">${typeof data.delta !== 'undefined' ? data.delta : '-'}</div>
                    `;
                } else if (cat.type === 'select') {
                    inputHtml += `
                        <select class="select-input">
                            <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                            ${cat.options.map(opt => `<option value="${opt}" ${data.value === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    `;
                }
                return inputHtml + '</div>';
            }).join('');
        }

        function saveWarehouseReport() {
            if (!currentWarehouse || !selectedWarehouseDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥ –∏ –¥–∞—Ç—É!');
                return;
            }
            const type = document.querySelector('input[name="warehouseReportType"]:checked').value;
            const reportData = {};
            CATEGORIES.forEach(cat => {
                if (cat.type === 'number' || cat.type === 'time') {
                    const planInput = document.querySelector(`#categoryInputs .category-block.${cat.type}[h4="${cat.name}"] .plan-input`);
                    const factInput = document.querySelector(`#categoryInputs .category-block.${cat.type}[h4="${cat.name}"] .fact-input`);
                    const plan = planInput ? planInput.value : '';
                    const fact = factInput ? factInput.value : '';
                    let delta = '-';
                    if (cat.type === 'number' && plan !== '' && fact !== '') {
                        delta = (parseFloat(fact) - parseFloat(plan)).toFixed(1);
                    } else if (cat.type === 'time') {
                        delta = '–ù–æ—Ä–º–∞';
                    }
                    reportData[cat.name] = { plan, fact, delta };
                } else if (cat.type === 'single') {
                    const input = document.querySelector(`#categoryInputs .category-block.${cat.type}[h4="${cat.name}"] .single-input`);
                    reportData[cat.name] = { value: input ? input.value : '' };
                } else if (cat.type === 'yesno') {
                    const block = document.querySelector(`#categoryInputs .category-block.yesno[h4="${cat.name}"]`);
                    const value = block ? block.dataset.yesnoValue || '' : '';
                    reportData[cat.name] = { value };
                } else if (cat.type === 'select') {
                    const select = document.querySelector(`#categoryInputs .category-block.${cat.type}[h4="${cat.name}"] select`);
                    reportData[cat.name] = { value: select ? select.value : '' };
                }
            });

            if (!reports[selectedWarehouseDate]) reports[selectedWarehouseDate] = {};
            if (!reports[selectedWarehouseDate][currentWarehouse]) reports[selectedWarehouseDate][currentWarehouse] = {};
            reports[selectedWarehouseDate][currentWarehouse][type] = reportData;
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            cleanOldReports();
            alert('–û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            showSummarySection();
        }

        function savePersonnelReport() {
            if (!currentPersonnelObj || !selectedPersonnelDate) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∏ –¥–∞—Ç—É!');
                return;
            }
            const type = document.querySelector('input[name="personnelReportType"]:checked').value;
            const reportData = {};
            PERSONNEL_CATEGORIES.forEach(cat => {
                if (cat.type === 'number') {
                    const planInput = document.querySelector(`#personnelCategoryInputs .category-block.${cat.type}[h4="${cat.name}"] .plan-input`);
                    const factInput = document.querySelector(`#personnelCategoryInputs .category-block.${cat.type}[h4="${cat.name}"] .fact-input`);
                    const plan = planInput ? planInput.value : '';
                    const fact = factInput ? factInput.value : '';
                    let delta = '-';
                    if (plan !== '' && fact !== '') {
                        delta = (parseFloat(fact) - parseFloat(plan)).toFixed(1);
                    }
                    reportData[cat.name] = { plan, fact, delta };
                } else if (cat.type === 'select') {
                    const select = document.querySelector(`#personnelCategoryInputs .category-block.${cat.type}[h4="${cat.name}"] select`);
                    reportData[cat.name] = { value: select ? select.value : '' };
                }
            });

            if (!personnelReports[selectedPersonnelDate]) personnelReports[selectedPersonnelDate] = {};
            if (!personnelReports[selectedPersonnelDate][currentPersonnelObj]) personnelReports[selectedPersonnelDate][currentPersonnelObj] = {};
            personnelReports[selectedPersonnelDate][currentPersonnelObj][type] = reportData;
            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
            cleanOldPersonnelReports();
            alert('–û—Ç—á–µ—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            showPersonnelSummarySection();
        }

        function showSummarySection() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('summarySection').classList.add('active');
            updateSummaryDateDisplay();
        }

        function showPersonnelSummarySection() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('personnelSummarySection').classList.add('active');
            document.getElementById('currentPersonnelSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
        }

        function showSummaryData() {
            const dateStr = selectedSummaryDate.toLocaleDateString('ru-RU');
            const includeDay = document.getElementById('summaryDay').checked;
            const includeNight = document.getElementById('summaryNight').checked;
            const managerFilter = document.getElementById('managerFilter').value;

            let rows = '';
            WAREHOUSES.forEach(wh => {
                const whData = reports[dateStr]?.[wh];
                if (!whData) return;

                let plan = 0, fact = 0, count = 0;
                if (includeDay && whData.day?.['–û–±—Ä–∞–±–æ—Ç–∫–∞']) {
                    plan += parseFloat(whData.day['–û–±—Ä–∞–±–æ—Ç–∫–∞'].plan) || 0;
                    fact += parseFloat(whData.day['–û–±—Ä–∞–±–æ—Ç–∫–∞'].fact) || 0;
                    count++;
                }
                if (includeNight && whData.night?.['–û–±—Ä–∞–±–æ—Ç–∫–∞']) {
                    plan += parseFloat(whData.night['–û–±—Ä–∞–±–æ—Ç–∫–∞'].plan) || 0;
                    fact += parseFloat(whData.night['–û–±—Ä–∞–±–æ—Ç–∫–∞'].fact) || 0;
                    count++;
                }

                const managerDay = whData.day?.['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                const managerNight = whData.night?.['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                const passesFilter = !managerFilter || 
                    (includeDay && managerDay === managerFilter) || 
                    (includeNight && managerNight === managerFilter) ||
                    (includeDay && includeNight && (managerDay === managerFilter || managerNight === managerFilter));

                if (!passesFilter) return;

                rows += `
                    <tr>
                        <td>${wh}</td>
                        <td>${plan > 0 ? plan.toFixed(1) : '-'}</td>
                        <td>${fact > 0 ? fact.toFixed(1) : '-'}</td>
                        <td>${count > 0 ? (fact - plan).toFixed(1) : '-'}</td>
                    </tr>
                `;
            });

            const tableHtml = `
                <table>
                    <thead><tr><th>–°–∫–ª–∞–¥</th><th>–ü–ª–∞–Ω</th><th>–§–∞–∫—Ç</th><th>Œî</th></tr></thead>
                    <tbody>${rows || '<tr><td colspan="4" style="text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>'}</tbody>
                </table>
            `;
            document.getElementById('summaryTable').innerHTML = tableHtml;
            document.getElementById('summarySection').classList.remove('active');
            document.getElementById('summaryTableSection').classList.add('active');
            document.getElementById('currentSummaryDate').textContent = dateStr;
        }

        function showPersonnelSummaryData() {
            const dateStr = selectedSummaryDate.toLocaleDateString('ru-RU');
            const includeDay = document.getElementById('personnelSummaryDay').checked;
            const includeNight = document.getElementById('personnelSummaryNight').checked;
            const managerFilter = document.getElementById('personnelManagerFilter').value;

            let rows = '';
            PERSONNEL_OBJECTS.forEach(obj => {
                const objData = personnelReports[dateStr]?.[obj];
                if (!objData) return;

                let staffPlan = 0, staffFact = 0, count = 0;
                if (includeDay && objData.day?.['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤']) {
                    staffPlan += parseFloat(objData.day['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'].plan) || 0;
                    staffFact += parseFloat(objData.day['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'].fact) || 0;
                    count++;
                }
                if (includeNight && objData.night?.['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤']) {
                    staffPlan += parseFloat(objData.night['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'].plan) || 0;
                    staffFact += parseFloat(objData.night['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'].fact) || 0;
                    count++;
                }

                const managerDay = objData.day?.['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                const managerNight = objData.night?.['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                const passesFilter = !managerFilter || 
                    (includeDay && managerDay === managerFilter) || 
                    (includeNight && managerNight === managerFilter);

                if (!passesFilter) return;

                rows += `
                    <tr>
                        <td>${obj}</td>
                        <td>${staffPlan > 0 ? staffPlan.toFixed(1) : '-'}</td>
                        <td>${staffFact > 0 ? staffFact.toFixed(1) : '-'}</td>
                    </tr>
                `;
            });

            const tableHtml = `
                <table>
                    <thead><tr><th>–û–±—ä–µ–∫—Ç</th><th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (–ø–ª–∞–Ω)</th><th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Ñ–∞–∫—Ç)</th></tr></thead>
                    <tbody>${rows || '<tr><td colspan="3" style="text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>'}</tbody>
                </table>
            `;
            document.getElementById('personnelSummaryTable').innerHTML = tableHtml;
            document.getElementById('personnelSummarySection').classList.remove('active');
            document.getElementById('personnelSummaryTableSection').classList.add('active');
            document.getElementById('currentPersonnelSummaryDate').textContent = dateStr;
        }

        function updateSummaryTable() {
            // Could be used for live filtering, but we recalc on "show"
        }
        function updatePersonnelSummaryTable() {
            // Same
        }

        function toggleFullScreen() {
            const fs = document.getElementById('fullScreenTable');
            const isHidden = fs.style.display === 'none';
            if (isHidden) {
                document.getElementById('fullSummaryTable').innerHTML = document.getElementById('summaryTable').innerHTML;
                fs.style.display = 'flex';
            } else {
                fs.style.display = 'none';
            }
        }

        function togglePersonnelFullScreen() {
            const fs = document.getElementById('psFullScreen');
            const isHidden = fs.style.display === 'none';
            if (isHidden) {
                document.getElementById('psFullTable').innerHTML = document.getElementById('personnelSummaryTable').innerHTML;
                fs.style.display = 'flex';
            } else {
                fs.style.display = 'none';
            }
        }

        function prevSummaryDay() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() - 1);
            document.getElementById('currentSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
            showSummaryData();
        }

        function nextSummaryDay() {
            selectedSummaryDate.setDate(selectedSummaryDate.getDate() + 1);
            document.getElementById('currentSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
            showSummaryData();
        }

        window.onload = function() {
            cleanOldReports();
            cleanOldPersonnelReports();
            generateWarehouseList();
            generatePersonnelList();
            currentDate = new Date();
            selectedSummaryDate = new Date();
            updateSummaryDateDisplay();
            document.getElementById('currentSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
            document.getElementById('currentPersonnelSummaryDate').textContent = selectedSummaryDate.toLocaleDateString('ru-RU');
        };
    </script>
</body>
</html>