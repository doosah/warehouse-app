<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞</title>
    <style>
:root {
    --primary-color: #667eea;
    --primary-dark: #764ba2;
    --secondary-color: #f093fb;
    --accent-color: #4facfe;
    --success-color: #43e97b;
    --error-color: #fa709a;
    --bg-dark: #0a0e27;
    --bg-darker: #1a1f3a;
    --bg-container: rgba(10, 14, 39, 0.85);
    --text-primary: #f0f4ff;
    --text-secondary: #c8d2e8;
    --border-color: rgba(135, 150, 200, 0.15);
    --touch-target: 44px;
}

body {
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #2d1b3d 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    color: var(--text-primary);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    min-height: 100vh;
    padding: 10px;
    margin: 0;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.container {
    background: var(--bg-container);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(135, 150, 200, 0.2);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6), 
                0 0 0 1px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-size: 200% 200%;
    animation: gradientFlow 8s ease infinite;
    color: white;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
    margin-bottom: 20px;
    border-radius: 12px 12px 0 0;
}

.header-inner {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo {
    height: 40px;
    width: auto;
    filter: drop-shadow(0 2px 8px rgba(102, 126, 234, 0.45));
    transition: transform 0.3s ease;
}

.logo:hover {
    transform: scale(1.05);
}

@media (max-width: 480px) {
    .logo { height: 32px; }
}

@keyframes gradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

h1 {
    color: #ffffff;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
    margin-bottom: 8px;
}

.subtitle {
    color: rgba(255, 255, 255, 0.85);
    font-size: 0.9em;
}

h2 {
    color: var(--text-primary);
    text-shadow: 0 1px 5px rgba(102, 126, 234, 0.2);
    margin-bottom: 15px;
}

.warehouse-btn {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(240, 147, 251, 0.3) 100%);
    background-size: 200% 200%;
    border: none;
    color: var(--text-primary);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
    padding: 16px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: var(--touch-target);
    text-align: center;
    font-size: clamp(12px, 2.5vw, 13px);
    font-weight: 500;
}

.warehouse-btn:hover {
    background-position: 100% 50%;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.warehouse-btn:active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.5) 0%, rgba(240, 147, 251, 0.5) 100%);
    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.section {
    padding: 20px;
    margin: 15px 0;
    border-radius: 12px;
    background: rgba(10, 14, 39, 0.9);
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
    display: none;
    animation: fadeIn 0.3s ease-in;
}

.section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.large-button {
    width: 100%;
    padding: 18px 40px;
    margin-bottom: 10px;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: 600;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4),
                0 2px 5px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.large-button:hover {
    background-position: 100% 50%;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5),
                0 3px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.large-button:active {
    transform: scale(0.98);
    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4),
                inset 0 2px 5px rgba(0, 0, 0, 0.3);
}

.button.secondary {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.3) 0%, rgba(102, 126, 234, 0.3) 100%);
    border: 1px solid rgba(135, 150, 200, 0.3);
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
}

.calendar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 3px;
    margin: 15px 0;
    padding: 10px;
    border-radius: 12px;
    background: rgba(30, 35, 60, 0.4);
    border: 1px solid var(--border-color);
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.05);
}

.calendar-header-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom: 10px;
}

.calendar-header {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(240, 147, 251, 0.2) 100%);
    background-size: 200% 200%;
    color: #d0dcff;
    padding: 6px 2px;
    border-radius: 6px;
    font-size: clamp(9px, 2vw, 11px);
    text-align: center;
}

.date-btn {
    background: rgba(51, 65, 85, 0.4);
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
    padding: 8px 4px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.date-btn.empty {
    color: rgba(255, 255, 255, 0.3);
    cursor: not-allowed;
    background: rgba(51, 65, 85, 0.2);
}

.date-btn:hover:not(.empty) {
    background: rgba(79, 172, 254, 0.3);
    border-color: rgba(102, 126, 234, 0.5);
    box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
}

.date-btn.selected {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #f093fb;
    box-shadow: 0 0 15px rgba(102, 126, 234, 0.6),
                inset 0 1px 2px rgba(255, 255, 255, 0.2);
}

.calendar-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.calendar-controls button {
    padding: 12px 16px;
    border-radius: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-size: 200% 200%;
    color: white;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 100px;
}

.calendar-controls button:hover {
    background-position: 100% 50%;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
}

.date-section {
    padding: 20px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(30, 35, 60, 0.4) 0%, rgba(45, 27, 61, 0.4) 100%);
    border: 1px solid var(--border-color);
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.05);
    margin-bottom: 20px;
}

.selected-date-display {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(240, 147, 251, 0.2) 100%);
    border: 1px solid rgba(102, 126, 234, 0.3);
    color: #d0dcff;
    padding: 12px 20px;
    border-radius: 8px;
    margin: 15px 0;
    text-align: center;
    font-weight: 500;
    font-size: clamp(14px, 3vw, 16px);
}

.radio-group {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: clamp(12px, 3vw, 13px);
    color: var(--text-secondary);
}

.input-row {
    display: flex;
    gap: 15px;
    margin: 10px 0;
}

.input-row div {
    flex: 1;
}

.category-input {
    margin-bottom: 20px;
    padding: 15px;
    border-radius: 12px;
    background: rgba(30, 35, 60, 0.6);
    border: 1px solid var(--border-color);
}

.delta-display {
    margin-top: 10px;
    padding: 8px;
    border-radius: 6px;
    color: var(--text-secondary);
}

.positive {
    color: #43e97b;
    font-weight: 600;
    text-shadow: 0 0 8px rgba(67, 233, 123, 0.4);
}

.negative {
    color: #fa709a;
    font-weight: 600;
    text-shadow: 0 0 8px rgba(250, 112, 154, 0.4);
}

.good {
    color: #43e97b;
    text-shadow: 0 0 5px rgba(67, 233, 123, 0.3);
}

.bad {
    color: #fa709a;
    text-shadow: 0 0 5px rgba(250, 112, 154, 0.3);
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

button {
    padding: 14px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-size: 200% 200%;
    color: white;
    transition: all 0.3s ease;
    font-size: clamp(14px, 3vw, 16px);
    font-weight: 500;
}

button:hover {
    background-position: 100% 50%;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

button:active {
    transform: scale(0.98);
    box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4),
                inset 0 2px 5px rgba(0, 0, 0, 0.3);
}

button.secondary {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.3) 0%, rgba(102, 126, 234, 0.3) 100%);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

button.secondary:hover {
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.5) 0%, rgba(102, 126, 234, 0.5) 100%);
    box-shadow: 0 6px 20px rgba(79, 172, 254, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.checkbox-group {
    margin-bottom: 20px;
}

.filter-section {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.1) 100%);
    border: 1px solid var(--border-color);
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.05);
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 20px;
}

.filter-section select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: rgba(30, 35, 60, 0.6);
    color: var(--text-primary);
}

.table-wrapper {
    border: 1px solid var(--border-color);
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.05);
    margin-top: 15px;
}

table {
    width: 100%;
    min-width: 600px;
    border-collapse: separate;
    border-spacing: 0;
    font-size: clamp(7px, 1.8vw, 10px);
    transform: scale(0.95);
    transform-origin: top left;
    width: calc(100% / 0.95);
}

th, td {
    border: 1px solid rgba(71, 85, 105, 0.3);
    padding: 4px 3px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

th {
    font-size: clamp(7px, 1.8vw, 9px);
    line-height: 1.3;
    padding: 6px 4px;
    position: sticky;
    top: 0;
    font-weight: 600;
    z-index: 10;
    background: var(--bg-darker);
}

td:first-child, th:first-child {
    width: 70px;
    min-width: 70px;
    max-width: 70px;
    position: sticky;
    left: 0;
    z-index: 5;
}

th:first-child {
    z-index: 15;
}

td:nth-child(2), th:nth-child(2) {
    width: 140px;
    min-width: 140px;
    max-width: 140px;
    position: sticky;
    left: 70px;
    z-index: 5;
    text-align: left;
    padding-left: 6px;
}

.summary-total {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    background-size: 200% 200%;
    color: white;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    font-size: clamp(16px, 4vw, 18px);
    font-weight: 600;
    margin-top: 20px;
}

.full-screen-table {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 14, 39, 0.98);
    backdrop-filter: blur(20px);
    z-index: 1000;
    overflow: auto;
    padding: 20px;
    display: none;
}

.close-full {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    color: white;
    border: none;
    padding: 14px 24px;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(250, 112, 154, 0.5),
                0 5px 15px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    font-size: clamp(14px, 3vw, 16px);
    margin-bottom: 20px;
}

.close-full:hover {
    box-shadow: 0 15px 40px rgba(250, 112, 154, 0.6),
                0 7px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
}

.close-full:active {
    box-shadow: 0 5px 20px rgba(250, 112, 154, 0.5),
                inset 0 2px 5px rgba(0, 0, 0, 0.3);
    transform: scale(0.95);
}

@media (max-width: 768px) {
    body { padding: 8px; }
    .container { border-radius: 16px; }
    .header { padding: 16px; }
    .section { padding: 16px; }
    .warehouse-list { grid-template-columns: 1fr; gap: 10px; }
    .calendar-controls { flex-direction: column; }
    .calendar-controls button { width: 100%; }
    button { font-size: 14px; padding: 12px 20px; }
    table { font-size: 7px; transform: scale(0.9); width: calc(100% / 0.9); }
    td:first-child, th:first-child { width: 60px; }
    td:nth-child(2), th:nth-child(2) { width: 120px; }
    th:nth-child(n+3), td:nth-child(n+3) { min-width: 30px; max-width: 40px; }
    .close-full { top: 10px; right: 10px; }
}

@media (max-width: 480px) {
    .warehouse-btn { font-size: 12px; padding: 14px; }
    h1 { font-size: 20px; }
    h2 { font-size: 18px; }
    button { font-size: 14px; padding: 12px 20px; }
    table { font-size: 6px; transform: scale(0.85); width: calc(100% / 0.85); }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation: none !important;
        transition: none !important;
    }
}

.yesno-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
}

.yes-btn, .no-btn {
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    flex: 1;
}

.yes-btn {
    background: #43e97b;
    border: 1px solid #43e97b;
}

.yes-btn:hover {
    background: #43e97b;
    filter: brightness(0.9);
}

.no-btn {
    background: #fa709a;
    border: 1px solid #fa709a;
}

.no-btn:hover {
    background: #fa709a;
    filter: brightness(0.9);
}

.yes-btn.active, .no-btn.active {
    box-shadow: 0 2px 8px rgba(67, 233, 123, 0.5);
}

.single-input {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: rgba(30, 35, 60, 0.6);
    color: var(--text-primary);
}

.select-input {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background: rgba(30, 35, 60, 0.6);
    color: var(--text-primary);
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-inner">
                <img src="image.png" alt="W V3LS3N" class="logo">
                <div class="header-text">
                    <h1>üìä –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
                    <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
            </div>
        </div>

        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –≤—ã–±–æ—Ä –æ—Ç—á—ë—Ç–∞ -->
        <div id="mainSection" class="section active">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—á—ë—Ç</h2>
            <div class="action-buttons">
                <button class="large-button" onclick="selectReport('operational')">üìÑ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</button>
                <button class="large-button" onclick="selectReport('personnel')">üìä –û—Ç—á–µ—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</button>
            </div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="secondary" onclick="fillTestData()">‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø–µ—Ä–∞—Ü–∏–∏)</button>
                <button class="secondary" onclick="fillPersonnelTestData()">‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä—Å–æ–Ω–∞–ª)</button>
            </div>
        </div>

        <!-- –û—Ç—á—ë—Ç –ø–æ —Å–∫–ª–∞–¥—É (–æ–ø–µ—Ä–∞—Ü–∏–∏) -->
        <div id="warehouseReportSection" class="section">
            <h2 id="warehouseTitle">–û—Ç—á—ë—Ç –ø–æ —Å–∫–ª–∞–¥—É</h2>
            <div class="warehouse-list" id="warehouseList"></div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriod()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarView()"><span id="warehouseViewToggleText">üìÖ –ù–µ–¥–µ–ª—è</span></button>
                    <button class="secondary" onclick="nextPeriod()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="warehouseCalendar" class="calendar"></div>
                <div id="selectedWarehouseDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group">
                <label><input type="radio" name="warehouseReportType" value="day" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</label>
                <label><input type="radio" name="warehouseReportType" value="night"> üåô –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</label>
            </div>
            <div id="categoryInputs"></div>
            <div class="action-buttons">
                <button onclick="saveWarehouseReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –û—Ç—á—ë—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É -->
        <div id="personnelReportSection" class="section">
            <h2 id="personnelTitle">–û—Ç—á—ë—Ç –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="warehouse-list" id="personnelList"></div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodPersonnel()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarViewPersonnel()"><span id="personnelViewToggleText">üìÖ –ù–µ–¥–µ–ª—è</span></button>
                    <button class="secondary" onclick="nextPeriodPersonnel()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="personnelCalendar" class="calendar"></div>
                <div id="selectedPersonnelDate" class="selected-date-display"></div>
            </div>
            <div class="radio-group">
                <label><input type="radio" name="personnelReportType" value="day" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</label>
                <label><input type="radio" name="personnelReportType" value="night"> üåô –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</label>
            </div>
            <div id="personnelCategoryInputs"></div>
            <div class="action-buttons">
                <button onclick="savePersonnelReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –°–≤–æ–¥ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div id="summarySection" class="section">
            <h2>üìä –û–±—â–∏–π —Å–≤–æ–¥ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="summaryDay" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ —Å–º–µ–Ω—ã</label>
                <label><input type="checkbox" id="summaryNight"> üåô –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã</label>
            </div>
            <div class="filter-section">
                <h4>üë§ –§–∏–ª—å—Ç—Ä –ø–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é</h4>
                <select id="managerFilter" onchange="updateSummaryTable()">
                    <option value="">–í—Å–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2</option>
                </select>
            </div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodSummary()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <button class="secondary" onclick="toggleCalendarViewSummary()"><span id="summaryViewToggleText">üìÜ –ú–µ—Å—è—Ü</span></button>
                    <button class="secondary" onclick="nextPeriodSummary()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
                <div id="summaryCalendar" class="calendar"></div>
            </div>
            <div class="action-buttons">
                <button onclick="showSummaryData()">üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div id="summaryTableSection" class="section">
            <h2>üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
            <div class="date-section">
                <div style="display:flex;flex-direction:column;gap:10px">
                    <button class="secondary" onclick="prevSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <div id="currentSummaryDate" style="text-align:center;font-size:clamp(16px,4vw,18px);font-weight:600;color:#c7d2fe;padding:10px"></div>
                    <button class="secondary" onclick="nextSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div id="summaryTable" class="table-wrapper"></div>
            <div class="action-buttons">
                <button onclick="toggleFullScreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                <button class="secondary" onclick="showSummarySection()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –°–≤–æ–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ -->
        <div id="personnelSummarySection" class="section">
            <h2>üìä –°–≤–æ–¥ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="checkbox-group">
                <label><input type="checkbox" id="personnelSummaryDay" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ —Å–º–µ–Ω—ã</label>
                <label><input type="checkbox" id="personnelSummaryNight"> üåô –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã</label>
            </div>
            <div class="filter-section">
                <h4>üë§ –§–∏–ª—å—Ç—Ä –ø–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é</h4>
                <select id="personnelManagerFilter" onchange="updatePersonnelSummaryTable()">
                    <option value="">–í—Å–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1</option>
                    <option value="–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.">–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2</option>
                </select>
            </div>
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPersonnelSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <button class="secondary" onclick="toggleCalendarViewPersonnelSummary()"><span id="personnelSummaryViewToggleText">üìÜ –ú–µ—Å—è—Ü</span></button>
                    <button class="secondary" onclick="nextPersonnelSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
                <div id="personnelSummaryCalendar" class="calendar"></div>
            </div>
            <div class="action-buttons">
                <button onclick="showPersonnelSummaryData()">üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ -->
        <div id="personnelSummaryTableSection" class="section">
            <h2>üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É</h2>
            <div class="date-section">
                <div style="display:flex;flex-direction:column;gap:10px">
                    <button class="secondary" onclick="prevPersonnelSummaryDay()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å</button>
                    <div id="currentPersonnelSummaryDate" style="text-align:center;font-size:clamp(16px,4vw,18px);font-weight:600;color:#c7d2fe;padding:10px"></div>
                    <button class="secondary" onclick="nextPersonnelSummaryDay()">–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí</button>
                </div>
            </div>
            <div id="personnelSummaryTable" class="table-wrapper"></div>
            <div class="action-buttons">
                <button onclick="togglePersonnelFullScreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                <button class="secondary" onclick="showPersonnelSummarySection()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –ü–æ–ª–Ω—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
        <div id="fullScreenTable" class="full-screen-table">
            <button class="close-full" onclick="toggleFullScreen()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            <div id="fullSummaryTable"></div>
        </div>

        <!-- –ü–æ–ª–Ω—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ -->
        <div id="psFullScreen" class="full-screen-table">
            <button class="close-full" onclick="togglePersonnelFullScreen()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
            <div id="psFullTable"></div>
        </div>

        <div id="console-output"></div>
    </div>

    <script>
        // –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        const WAREHOUSES = [
            "–ê–†–•–ê–ù–ì–ï–õ–¨–°–ö_–•–ê–ë_–ù–ê–•–ò–ú–û–í–ê","–ú–£–†–ú–ê–ù–°–ö_–•–ê–ë_–û–ë–™–ï–ó–î–ù–ê–Ø","–í–ï–õ–ò–ö–ò–ô_–ù–û–í–ì–û–†–û–î_–•–ê–ë_–ù–ï–•–ò–ù–°–ö–ê–Ø",
            "–ü–ï–¢–†–û–ó–ê–í–û–î–°–ö_–•–ê–ë_–ü–†–Ø–ñ–ò–ù–°–ö–û–ï","–ü–°–ö–û–í_–•–ê–ë_–ú–ê–†–ì–ï–õ–û–í–ê","–ü–°–ö–û–í_–•–ê–ë_–ù–û–í–´–ô",
            "–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–õ–ï–°–û–ü–ê–†–ö–û–í–ê–Ø","–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–û–ö–¢–Ø–ë–†–¨–°–ö–ò–ô","–ß–ï–†–ï–ü–û–í–ï–¶_–•–ê–ë_–°–¢–†–û–ô–ò–ù–î–£–°–¢–†–ò–ò","–í–û–õ–û–ì–î–ê_–•–ê–ë_–ë–ï–õ–û–ó–ï–†–°–ö–û–ï"
        ];
        const CATEGORIES = [
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞', type: 'number'},
            {name: '–ü–µ—Ä—Å–æ–Ω–∞–ª', type: 'number'},
            {name: '–û–∫–æ–Ω—á–∞–Ω–∏–µ –≤—ã–¥–∞—á–∏', type: 'time'},
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞ FBS', type: 'number'},
            {name: '–í–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –ø–æ—Ç–æ–∫ (–ë—ç–∫–ª–æ–≥)', type: 'number'},
            {name: '–û–±–µ–∑–ª–∏—á–∫–∞', type: 'single', label: '–ü–æ–¥–¥–æ–Ω—ã', unit: '—à—Ç'},
            {name: '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', type: 'number'},
            {name: '–ö–æ–ª-–≤–æ –ø–∞–ª–ª–µ—Ç–∞-–º–µ—Å—Ç –∫ –æ—Ç–≥—Ä—É–∑–∫–µ', type: 'triple',
             fields: [{n: 'FBS', u: '—à—Ç'}, {n: 'X-Dock', u: '—à—Ç'}, {n: '–í–æ–∑–≤—Ä–∞—Ç—ã', u: '—à—Ç'}]},
            {name: '–•—Ä–æ–Ω—å –•–î', type: 'double',
             fields: [{n: '–°–æ—Ä—Ç', u: '—à—Ç'}, {n: '–ù–æ–Ω-–°–æ—Ä—Ç', u: '—à—Ç'}]},
            {name: '–†–∏—Å–∫–∏', type: 'yesno'},
            {name: '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –í—ã–¥–∞—á–∞', type: 'single', label: '–ó–Ω–∞—á–µ–Ω–∏–µ', unit: '—à—Ç'},
            '% –Ω–µ –ø—Ä–æ—Ñ–∏–ª—è': {name: '% –Ω–µ –ø—Ä–æ—Ñ–∏–ª—è', type: 'single', label: '–ü—Ä–æ—Ü–µ–Ω—Ç', unit: '%'},
            {name: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', type: 'select', options: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.']}
        ];
        let reports = JSON.parse(localStorage.getItem('warehouseReports')) || {};
        let currentDate = new Date();
        let warehouseCalendarView = 'week';
        let selectedWarehouseDate = null;
        let currentWarehouse = '';
        let selectedSummaryDate = null;

        // –î–∞–Ω–Ω—ã–µ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É
        const PERSONNEL_OBJECTS = ["–û—Ç–¥–µ–ª 1", "–û—Ç–¥–µ–ª 2", "–û—Ç–¥–µ–ª 3", "–û—Ç–¥–µ–ª 4"];
        const PERSONNEL_CATEGORIES = [
            {name: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', type: 'number'},
            {name: '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤', type: 'number'},
            {name: '–ü—Ä–æ–ø—É—Å–∫–∏', type: 'number'},
            {name: '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å', type: 'select', options: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.']}
        ];
        let personnelReports = JSON.parse(localStorage.getItem('personnelReports')) || {};
        let currentPersonnelObj = '';
        let selectedPersonnelDate = null;
        let personnelCalendarView = 'week';

        // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (6 –º–µ—Å—è—Ü–µ–≤)
        function cleanOldReports(reportsObj) {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const keysToDelete = [];
            Object.keys(reportsObj).forEach(dateStr => {
                try {
                    const [day, month, year] = dateStr.split('.').map(Number);
                    const reportDate = new Date(year, month - 1, day);
                    if (reportDate < sixMonthsAgo) {
                        keysToDelete.push(dateStr);
                    }
                } catch (e) {
                    keysToDelete.push(dateStr);
                }
            });
            keysToDelete.forEach(key => delete reportsObj[key]);
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Å–∫–ª–∞–¥–æ–≤
        function generateWarehouseList() {
            const list = document.getElementById('warehouseList');
            list.innerHTML = WAREHOUSES.map(wh => `
                <button class="warehouse-btn" onclick="showWarehouseReport('${wh}')">${wh}</button>
            `).join('');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function generatePersonnelList() {
            const list = document.getElementById('personnelList');
            list.innerHTML = PERSONNEL_OBJECTS.map(obj => `
                <button class="warehouse-btn" onclick="showPersonnelReport('${obj}')">${obj}</button>
            `).join('');
        }

        // –†–∞–±–æ—Ç–∞ —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—è–º–∏
        function renderCalendar(calendarId, viewMode, onSelect, selectedDate) {
            const cal = document.getElementById(calendarId);
            cal.innerHTML = '';
            const today = new Date();
            const daysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];

            // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ–¥–µ–ª–∏
            const headerRow = document.createElement('div');
            headerRow.className = 'calendar-header-row';
            headerRow.innerHTML = daysOfWeek.map(day => `
                <div class="calendar-header">${day}</div>
            `).join('');
            cal.appendChild(headerRow);

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç –¥–ª—è —Ä–µ–∂–∏–º–∞
            let dates = [];
            if (viewMode === 'week') {
                const startDay = new Date(today);
                startDay.setDate(today.getDate() - ((today.getDay() || 7) - 1));
                for (let i = 0; i < 7; i++) {
                    const d = new Date(startDay);
                    d.setDate(startDay.getDate() + i);
                    dates.push(d);
                }
            } else {
                const [year, month] = [today.getFullYear(), today.getMonth()];
                const firstDay = new Date(year, month, 1);
                const startDayOfWeek = firstDay.getDay() || 7;
                const lastDay = new Date(year, month + 1, 0);
                
                // –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã–º–∏ –¥–Ω—è–º–∏
                for (let i = 0; i < startDayOfWeek - 1; i++) {
                    dates.push(null);
                }
                
                // –î–Ω–∏ –º–µ—Å—è—Ü–∞
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    dates.push(new Date(year, month, day));
                }
            }

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–∞—Ç
            const datesContainer = document.createElement('div');
            datesContainer.style.display = 'grid';
            datesContainer.style.gridTemplateColumns = 'repeat(7, 1fr)';
            datesContainer.style.gap = '3px';
            
            dates.forEach(date => {
                const b = document.createElement('button');
                b.className = 'date-btn';
                if (!date) {
                    b.className += ' empty';
                    b.textContent = '';
                    b.disabled = true;
                } else {
                    const isToday = date.toDateString() === today.toDateString();
                    const isSelected = selectedDate ? date.toDateString() === selectedDate.toDateString() : false;
                    b.textContent = date.getDate();
                    b.disabled = false;
                    b.onclick = () => {
                        currentDate = new Date(date);
                        selectedDate = new Date(date);
                        onSelect(date);
                    };
                    if (isSelected) b.className += ' selected';
                    if (isToday) b.style.boxShadow = 'inset 0 2px 4px rgba(102, 126, 234, 0.3)';
                }
                datesContainer.appendChild(b);
            });

            cal.appendChild(datesContainer);
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
        function renderWarehouseCalendar() {
            renderCalendar('warehouseCalendar', warehouseCalendarView, () => {
                selectedWarehouseDate = currentDate.toLocaleDateString('ru-RU');
                document.getElementById('selectedWarehouseDate').textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selectedWarehouseDate}`;
                loadCategoryInputs();
            }, selectedWarehouseDate);
            document.getElementById('warehouseViewToggleText').textContent = 
                warehouseCalendarView === 'week' ? 'üìÖ –ù–µ–¥–µ–ª—è' : 'üìÜ –ú–µ—Å—è—Ü';
        }

        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function renderPersonnelCalendar() {
            renderCalendar('personnelCalendar', personnelCalendarView, () => {
                selectedPersonnelDate = currentDate.toLocaleDateString('ru-RU');
                document.getElementById('selectedPersonnelDate').textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selectedPersonnelDate}`;
                loadPersonnelCategoryInputs();
            }, selectedPersonnelDate);
            document.getElementById('personnelViewToggleText').textContent = 
                personnelCalendarView === 'week' ? 'üìÖ –ù–µ–¥–µ–ª—è' : 'üìÜ –ú–µ—Å—è—Ü';
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é –æ–ø–µ—Ä–∞—Ü–∏–π
        function prevPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderWarehouseCalendar();
        }

        function nextPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderWarehouseCalendar();
        }

        function toggleCalendarView() {
            warehouseCalendarView = warehouseCalendarView === 'week' ? 'month' : 'week';
            renderWarehouseCalendar();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function prevPeriodPersonnel() {
            if (personnelCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderPersonnelCalendar();
        }

        function nextPeriodPersonnel() {
            if (personnelCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderPersonnelCalendar();
        }

        function toggleCalendarViewPersonnel() {
            personnelCalendarView = personnelCalendarView === 'week' ? 'month' : 'week';
            renderPersonnelCalendar();
        }

        // –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –æ–ø–µ—Ä–∞—Ü–∏–π
        function showWarehouseReport(wh) {
            currentWarehouse = wh;
            document.getElementById('warehouseTitle').textContent = `üìç –°–∫–ª–∞–¥: ${wh}`;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('warehouseReportSection').classList.add('active');
            currentDate = new Date(); // –°–±—Ä–æ—Å –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–∫–ª–∞–¥–∞
            selectedWarehouseDate = currentDate.toLocaleDateString('ru-RU');
            document.getElementById('selectedWarehouseDate').textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selectedWarehouseDate}`;
            renderWarehouseCalendar();
            loadCategoryInputs();
        }

        // –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function showPersonnelReport(obj) {
            currentPersonnelObj = obj;
            document.getElementById('personnelTitle').textContent = `üìç –û–±—ä–µ–∫—Ç: ${obj}`;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('personnelReportSection').classList.add('active');
            currentDate = new Date(); // –°–±—Ä–æ—Å –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞
            selectedPersonnelDate = currentDate.toLocaleDateString('ru-RU');
            document.getElementById('selectedPersonnelDate').textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selectedPersonnelDate}`;
            renderPersonnelCalendar();
            loadPersonnelCategoryInputs();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        function fillTestData() {
            cleanOldReports(reports);
            const testDates = [];
            for (let i = 0; i < 5; i++) {
                const d = new Date(currentDate);
                d.setDate(currentDate.getDate() - i);
                testDates.push(d.toLocaleDateString('ru-RU'));
            }

            WAREHOUSES.forEach(wh => {
                testDates.forEach(date => {
                    if (!reports[date]) reports[date] = {};
                    if (!reports[date][wh]) reports[date][wh] = {};

                    reports[date][wh].day = {
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞': { plan: 200 + Math.floor(Math.random() * 50), fact: 210 + Math.floor(Math.random() * 40) },
                        '–ü–µ—Ä—Å–æ–Ω–∞–ª': { plan: 15 + Math.floor(Math.random() * 5), fact: 15 + Math.floor(Math.random() * 5) },
                        '–û–∫–æ–Ω—á–∞–Ω–∏–µ –≤—ã–¥–∞—á–∏': { plan: '12:00', fact: `${12}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}` },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞ FBS': { plan: 50 + Math.floor(Math.random() * 20), fact: 45 + Math.floor(Math.random() * 20) },
                        '–í–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –ø–æ—Ç–æ–∫ (–ë—ç–∫–ª–æ–≥)': { plan: 10, fact: 12 + Math.floor(Math.random() * 5) },
                        '–û–±–µ–∑–ª–∏—á–∫–∞': { value: 30 + Math.floor(Math.random() * 20) },
                        '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': { plan: 90 + Math.floor(Math.random() * 8), fact: 92 + Math.floor(Math.random() * 7) },
                        '–ö–æ–ª-–≤–æ –ø–∞–ª–ª–µ—Ç–∞-–º–µ—Å—Ç –∫ –æ—Ç–≥—Ä—É–∑–∫–µ': {
                            FBS: 20 + Math.floor(Math.random() * 10),
                            X_Dock: 15 + Math.floor(Math.random() * 8),
                            –í–æ–∑–≤—Ä–∞—Ç—ã: 5 + Math.floor(Math.random() * 5)
                        },
                        '–•—Ä–æ–Ω—å –•–î': {
                            –°–æ—Ä—Ç: 30 + Math.floor(Math.random() * 15),
                            –ù–æ–Ω-–°–æ—Ä—Ç: 25 + Math.floor(Math.random() * 10)
                        },
                        '–†–∏—Å–∫–∏': { value: Math.random() < 0.5 ? 'yes' : 'no' },
                        '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –í—ã–¥–∞—á–∞': { value: 50 + Math.floor(Math.random() * 30) },
                        '% –Ω–µ –ø—Ä–æ—Ñ–∏–ª—è': { value: 5 + Math.floor(Math.random() * 10) },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.'][Math.floor(Math.random() * 2)] }
                    };

                    reports[date][wh].night = {
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞': { plan: 100 + Math.floor(Math.random() * 30), fact: 105 + Math.floor(Math.random() * 25) },
                        '–ü–µ—Ä—Å–æ–Ω–∞–ª': { plan: 8 + Math.floor(Math.random() * 4), fact: 8 + Math.floor(Math.random() * 4) },
                        '–û–∫–æ–Ω—á–∞–Ω–∏–µ –≤—ã–¥–∞—á–∏': { plan: '03:00', fact: `${3}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}` },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞ FBS': { plan: 20 + Math.floor(Math.random() * 15), fact: 18 + Math.floor(Math.random() * 15) },
                        '–í–æ–∑–≤—Ä–∞—Ç–Ω—ã–π –ø–æ—Ç–æ–∫ (–ë—ç–∫–ª–æ–≥)': { plan: 3, fact: 4 + Math.floor(Math.random() * 3) },
                        '–û–±–µ–∑–ª–∏—á–∫–∞': { value: 10 + Math.floor(Math.random() * 15) },
                        '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': { plan: 85 + Math.floor(Math.random() * 9), fact: 87 + Math.floor(Math.random() * 8) },
                        '–ö–æ–ª-–≤–æ –ø–∞–ª–ª–µ—Ç–∞-–º–µ—Å—Ç –∫ –æ—Ç–≥—Ä—É–∑–∫–µ': {
                            FBS: 10 + Math.floor(Math.random() * 7),
                            X_Dock: 8 + Math.floor(Math.random() * 5),
                            –í–æ–∑–≤—Ä–∞—Ç—ã: 3 + Math.floor(Math.random() * 4)
                        },
                        '–•—Ä–æ–Ω—å –•–î': {
                            –°–æ—Ä—Ç: 15 + Math.floor(Math.random() * 10),
                            –ù–æ–Ω-–°–æ—Ä—Ç: 12 + Math.floor(Math.random() * 8)
                        },
                        '–†–∏—Å–∫–∏': { value: Math.random() < 0.5 ? 'yes' : 'no' },
                        '–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –í—ã–¥–∞—á–∞': { value: 25 + Math.floor(Math.random() * 15) },
                        '% –Ω–µ –ø—Ä–æ—Ñ–∏–ª—è': { value: 3 + Math.floor(Math.random() * 7) },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.'][Math.floor(Math.random() * 2)] }
                    };
                });
            });

            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            alert(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n\nüì¶ –°–∫–ª–∞–¥–æ–≤: ${WAREHOUSES.length}\nüìÖ –î–∞—Ç: 5`);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function fillPersonnelTestData() {
            cleanOldReports(personnelReports);
            const testDates = [];
            for (let i = 0; i < 5; i++) {
                const d = new Date(currentDate);
                d.setDate(currentDate.getDate() - i);
                testDates.push(d.toLocaleDateString('ru-RU'));
            }

            PERSONNEL_OBJECTS.forEach(obj => {
                testDates.forEach(date => {
                    if (!personnelReports[date]) personnelReports[date] = {};
                    if (!personnelReports[date][obj]) personnelReports[date][obj] = {};

                    personnelReports[date][obj].day = {
                        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤': { plan: 20, fact: 20 + Math.floor(Math.random() * 5) },
                        '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤': { plan: 8, fact: 8 },
                        '–ü—Ä–æ–ø—É—Å–∫–∏': { plan: 0, fact: Math.floor(Math.random() * 2) },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.'][Math.floor(Math.random() * 2)] }
                    };

                    personnelReports[date][obj].night = {
                        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤': { plan: 10, fact: 10 + Math.floor(Math.random() * 3) },
                        '–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤': { plan: 4, fact: 4 },
                        '–ü—Ä–æ–ø—É—Å–∫–∏': { plan: 0, fact: Math.floor(Math.random() * 2) },
                        '–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å': { value: ['–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 1 –®—É—Ç–∏–Ω –î.–ú.', '–¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è 2 –õ—é–±–∞–≤–∫—Å–∫–∞—è –ú.–ò.'][Math.floor(Math.random() * 2)] }
                    };
                });
            });

            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
            alert(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\nüì¶ –û–±—ä–µ–∫—Ç–æ–≤: ${PERSONNEL_OBJECTS.length}\nüìÖ –î–∞—Ç: 5`);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
        function loadCategoryInputs() {
            if (!currentWarehouse || !selectedWarehouseDate) return;
            const type = document.querySelector('input[name="warehouseReportType"]:checked').value;
            const categoryDiv = document.getElementById('categoryInputs');
            categoryDiv.innerHTML = '';

            CATEGORIES.forEach(cat => {
                const data = reports[selectedWarehouseDate][currentWarehouse][type]?.[cat.name] || {};
                const cd = document.createElement('div');
                cd.className = `category-input ${cat.type}`;
                cd.innerHTML = `
                    <h4>${cat.name}</h4>
                `;

                const createInput = () => {
                    if (cat.type === 'number') {
                        cd.innerHTML += `
                            <div class="input-row">
                                <div><label>–ü–ª–∞–Ω:</label><input type="number" class="plan-input" value="${data.plan || ''}"></div>
                                <div><label>–§–∞–∫—Ç:</label><input type="number" class="fact-input" value="${data.fact || ''}"></div>
                            </div>
                            <div class="delta-display">Œî: <span class="delta">${data.delta !== undefined ? data.delta : '-'}</span></div>
                        `;
                    } else if (cat.type === 'time') {
                        cd.innerHTML += `
                            <div class="input-row">
                                <div><label>–ü–ª–∞–Ω:</label><input type="text" class="time-input" value="${data.plan || ''}"></div>
                                <div><label>–§–∞–∫—Ç:</label><input type="text" class="time-input" value="${data.fact || ''}"></div>
                            </div>
                            <div class="delta-display" style="font-weight: 600;">
                                Œî: <span class="delta">${data.delta !== undefined ? (data.delta === '–ù–æ—Ä–º–∞' ? '‚úÖ' : '‚ùå') : '-'}</span>
                            </div>
                        `;
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏
                        const factInput = cd.querySelector('.time-input');
                        factInput.addEventListener('input', () => {
                            const plan = cd.querySelector('.time-input:first-child').value;
                            const fact = factInput.value;
                            const deltaEl = cd.querySelector('.delta');
                            const p = parseTimeToMin(plan);
                            const f = parseTimeToMin(fact);
                            if (!isNaN(p) && !isNaN(f)) {
                                deltaEl.textContent = f <= p ? '–ù–æ—Ä–º–∞' : '–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ';
                                deltaEl.className = f <= p ? 'good' : 'bad';
                            } else {
                                deltaEl.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–ß–ß:–ú–ú)';
                                deltaEl.className = 'bad';
                            }
                        });
                    } else if (cat.type === 'single') {
                        cd.innerHTML += `
                            <div>
                                <label>${cat.label} (${cat.unit}):</label>
                                <input type="number" class="single-input" value="${data.value || ''}">
                            </div>
                        `;
                    } else if (cat.type === 'triple') {
                        cd.innerHTML += `
                            <div class="input-triple">
                                ${cat.fields.map(f => `
                                    <div><label>${f.n} (${f.u}):</label><input type="number" class="triple-input" value="${data[f.n] || ''}"></div>
                                `).join('')}
                            </div>
                        `;
                    } else if (cat.type === 'double') {
                        cd.innerHTML += `
                            <div class="input-double">
                                ${cat.fields.map(f => `
                                    <div><label>${f.n} (${f.u}):</label><input type="number" class="double-input" value="${data[f.n] || ''}"></div>
                                `).join('')}
                            </div>
                        `;
                    } else if (cat.type === 'yesno') {
                        cd.innerHTML += `
                            <div class="yesno-buttons">
                                <button class="yes-btn ${data.value === 'yes' ? 'active' : ''}" 
                                        onclick="handleYesNo('${cat.name}', 'yes', this)">–î–∞</button>
                                <button class="no-btn ${data.value === 'no' ? 'active' : ''}" 
                                        onclick="handleYesNo('${cat.name}', 'no', this)">–ù–µ—Ç</button>
                            </div>
                        `;
                    } else if (cat.type === 'select') {
                        cd.innerHTML += `
                            <div>
                                <label>–í—ã–±–µ—Ä–∏—Ç–µ ${cat.name}:</label>
                                <select class="select-input">
                                    <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                                    ${cat.options.map(opt => `
                                        <option value="${opt}" ${data.value === opt ? 'selected' : ''}>${opt}</option>
                                    `).join('')}
                                </select>
                            </div>
                        `;
                    }
                    categoryDiv.appendChild(cd);
                };

                createInput();
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –î–∞/–ù–µ—Ç –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
        function handleYesNo(categoryName, value, button) {
            const otherButton = button.classList.contains('yes-btn') 
                ? cd.querySelector('.no-btn') 
                : cd.querySelector('.yes-btn');
            
            otherButton.classList.remove('active');
            button.classList.add('active');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            const currentData = reports[selectedWarehouseDate][currentWarehouse][type];
            currentData[categoryName].value = value;
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
        }

        // –ü–∞—Ä—Å–∏–º –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç—ã
        function parseTimeToMin(timeStr) {
            if (!timeStr) return NaN;
            const [h, m] = timeStr.split(':').map(Number);
            return isNaN(h) || isNaN(m) ? NaN : h * 60 + m;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
        function saveWarehouseReport() {
            if (!currentWarehouse || !selectedWarehouseDate) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥ –∏ –¥–∞—Ç—É!');
                return;
            }
            const type = document.querySelector('input[name="warehouseReportType"]:checked').value;
            const reportData = {};

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            CATEGORIES.forEach(cat => {
                let data = {};
                const inputEl = document.querySelector(`.category-input.${cat.type}`);
                if (!inputEl) return;

                if (cat.type === 'number') {
                    const plan = parseInt(inputEl.querySelector('.plan-input').value) || 0;
                    const fact = parseInt(inputEl.querySelector('.fact-input').value) || 0;
                    data = { plan, fact, delta: fact - plan };
                } else if (cat.type === 'time') {
                    const plan = inputEl.querySelector('.time-input:first-child').value.trim();
                    const fact = inputEl.querySelector('.time-input:last-child').value.trim();
                    const p = parseTimeToMin(plan);
                    const f = parseTimeToMin(fact);
                    data = { 
                        plan, 
                        fact, 
                        delta: !isNaN(p) && !isNaN(f) ? (f <= p ? '–ù–æ—Ä–º–∞' : '–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ') : '–û—à–∏–±–∫–∞' 
                    };
                } else if (cat.type === 'single') {
                    data.value = parseInt(inputEl.querySelector('.single-input').value) || 0;
                } else if (cat.type === 'triple') {
                    data = cat.fields.reduce((acc, f) => {
                        acc[f.n] = parseInt(inputEl.querySelector(`.triple-input`).value) || 0;
                        return acc;
                    }, {});
                } else if (cat.type === 'double') {
                    data = cat.fields.reduce((acc, f) => {
                        acc[f.n] = parseInt(inputEl.querySelector(`.double-input`).value) || 0;
                        return acc;
                    }, {});
                } else if (cat.type === 'yesno') {
                    data.value = inputEl.querySelector('.yes-btn.active') ? 'yes' : 
                                 inputEl.querySelector('.no-btn.active') ? 'no' : '';
                } else if (cat.type === 'select') {
                    data.value = inputEl.querySelector('.select-input').value.trim();
                }

                reportData[cat.name] = data;
            });

            reports[selectedWarehouseDate][currentWarehouse][type] = reportData;
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            cleanOldReports(reports);
            alert('‚úÖ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            showSummarySection();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function loadPersonnelCategoryInputs() {
            if (!currentPersonnelObj || !selectedPersonnelDate) return;
            const type = document.querySelector('input[name="personnelReportType"]:checked').value;
            const categoryDiv = document.getElementById('personnelCategoryInputs');
            categoryDiv.innerHTML = '';

            PERSONNEL_CATEGORIES.forEach(cat => {
                const data = personnelReports[selectedPersonnelDate][currentPersonnelObj][type]?.[cat.name] || {};
                const cd = document.createElement('div');
                cd.className = `category-input ${cat.type}`;
                cd.innerHTML = `<h4>${cat.name}</h4>`;

                if (cat.type === 'number') {
                    cd.innerHTML += `
                        <div class="input-row">
                            <div><label>–ü–ª–∞–Ω:</label><input type="number" class="plan-input" value="${data.plan || ''}"></div>
                            <div><label>–§–∞–∫—Ç:</label><input type="number" class="fact-input" value="${data.fact || ''}"></div>
                        </div>
                        <div class="delta-display">Œî: <span class="delta">${data.delta !== undefined ? data.delta : '-'}</span></div>
                    `;
                    // –û–±–Ω–æ–≤–ª—è–µ–º delta –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π
                    const factInput = cd.querySelector('.fact-input');
                    factInput.addEventListener('input', () => {
                        const plan = parseInt(cd.querySelector('.plan-input').value) || 0;
                        const fact = parseInt(factInput.value) || 0;
                        cd.querySelector('.delta').textContent = fact - plan;
                        cd.querySelector('.delta').className = `delta ${fact - plan >= 0 ? 'positive' : 'negative'}`;
                    });
                } else if (cat.type === 'select') {
                    cd.innerHTML += `
                        <div>
                            <label>–í—ã–±–µ—Ä–∏—Ç–µ ${cat.name}:</label>
                            <select class="select-input">
                                <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                                ${cat.options.map(opt => `
                                    <option value="${opt}" ${data.value === opt ? 'selected' : ''}>${opt}</option>
                                `).join('')}
                            </select>
                        </div>
                    `;
                    data.value = cd.querySelector('.select-input').value.trim();
                }
                categoryDiv.appendChild(cd);
            });
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function savePersonnelReport() {
            if (!currentPersonnelObj || !selectedPersonnelDate) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç –∏ –¥–∞—Ç—É!');
                return;
            }
            const type = document.querySelector('input[name="personnelReportType"]:checked').value;
            const personnelData = {};

            PERSONNEL_CATEGORIES.forEach(cat => {
                let data = {};
                const inputEl = document.querySelector(`.category-input.${cat.type}`);
                if (!inputEl) return;

                if (cat.type === 'number') {
                    const plan = parseInt(inputEl.querySelector('.plan-input').value) || 0;
                    const fact = parseInt(inputEl.querySelector('.fact-input').value) || 0;
                    data = { plan, fact, delta: fact - plan };
                } else if (cat.type === 'select') {
                    data.value = inputEl.querySelector('.select-input').value.trim();
                }

                personnelData[cat.name] = data;
            });

            personnelReports[selectedPersonnelDate][currentPersonnelObj][type] = personnelData;
            localStorage.setItem('personnelReports', JSON.stringify(personnelReports));
            cleanOldReports(personnelReports);
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            showPersonnelSummarySection();
        }

        // –°–º–µ–Ω–∞ —Ä–∞–∑–¥–µ–ª–∞
        function selectReport(reportType) {
            backToMain();
            currentDate = new Date();
            switch (reportType) {
                case 'operational':
                    showWarehouseReport(WAREHOUSES[0]); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–∫–ª–∞–¥
                    break;
                case 'personnel':
                    showPersonnelReport(PERSONNEL_OBJECTS[0]); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –æ–±—ä–µ–∫—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
                    break;
            }
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function backToMain() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('mainSection').classList.add('active');
            currentWarehouse = currentPersonnelObj = '';
            selectedWarehouseDate = selectedPersonnelDate = selectedSummaryDate = null;
        }

        // –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        function showSummaryData() {
            if (!selectedSummaryDate) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ!');
                return;
            }
            const includeDay = document.getElementById('summaryDay').checked;
            const includeNight = document.getElementById('summaryNight').checked;
            const managerFilter = document.getElementById('managerFilter').value;

            if (!includeDay && !includeNight) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–º–µ–Ω—ã!');
                return;
            }

            const summaryDate = new Date(selectedSummaryDate);
            const tableData = [];

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Å–∫–ª–∞–¥
            WAREHOUSES.forEach(wh => {
                const whData = reports[summaryDate.toLocaleDateString('ru-RU')]?.[wh] || {};
                
                // –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞
                if (includeDay) {
                    const dayData = whData.day || {};
                    const manager = dayData['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                    if (!managerFilter || manager === managerFilter) {
                        tableData.push({
                            type: 'day',
                            wh,
                            data: dayData
                        });
                    }
                }

                // –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞
                if (includeNight) {
                    const nightData = whData.night || {};
                    const manager = nightData['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                    if (!managerFilter || manager === managerFilter) {
                        tableData.push({
                            type: 'night',
                            wh,
                            data: nightData
                        });
                    }
                }
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML —Ç–∞–±–ª–∏—Ü—ã
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>–°–∫–ª–∞–¥</th>
                            <th>–¢–∏–ø —Å–º–µ–Ω—ã</th>
                            ${CATEGORIES.map(cat => `
                                <th>${cat.name}</th>
                            `).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${tableData.map(item => `
                            <tr>
                                <td>${item.wh}</td>
                                <td>${item.type === 'day' ? '‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è' : 'üåô –ù–æ—á–Ω–∞—è'}</td>
                                ${CATEGORIES.map(cat => {
                                    const data = item.data[cat.name] || {};
                                    if (cat.type === 'number') {
                                        return `
                                            <td>${data.plan || '-'}</td>
                                            <td>${data.fact || '-'}</td>
                                            <td class="${data.delta >= 0 ? 'positive' : 'negative'}">${data.delta || '-'}</td>
                                        `;
                                    } else if (cat.type === 'time') {
                                        return `
                                            <td>${data.plan || '-'}</td>
                                            <td>${data.fact || '-'}</td>
                                            <td class="${data.delta === '–ù–æ—Ä–º–∞' ? 'good' : 'bad'}">${data.delta || '-'}</td>
                                        `;
                                    } else if (cat.type === 'single') {
                                        return `<td>${data.value || '-'}</td>`;
                                    } else if (cat.type === 'triple') {
                                        return `
                                            <td>${data.FBS || '-'}</td>
                                            <td>${data.X_Dock || '-'}</td>
                                            <td>${data.–í–æ–∑–≤—Ä–∞—Ç—ã || '-'}</td>
                                        `;
                                    } else if (cat.type === 'double') {
                                        return `
                                            <td>${data.–°–æ—Ä—Ç || '-'}</td>
                                            <td>${data.–ù–æ–Ω-–°–æ—Ä—Ç || '-'}</td>
                                        `;
                                    } else if (cat.type === 'yesno') {
                                        return `<td>${data.value === 'yes' ? '‚úÖ' : '‚ùå'}</td>`;
                                    } else if (cat.type === 'select') {
                                        return `<td>${data.value || '-'}</td>`;
                                    }
                                    return '<td>-</td>';
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="summary-total">
                    –ò—Ç–æ–≥–æ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ (–ø–ª–∞–Ω):
                    ${WAREHOUSES.reduce((sum, wh) => {
                        const whDataDay = whData.day?.['–û–±—Ä–∞–±–æ—Ç–∫–∞']?.plan || 0;
                        const whDataNight = whData.night?.['–û–±—Ä–∞–±–æ—Ç–∫–∞']?.plan || 0;
                        return sum + (includeDay ? whDataDay : 0) + (includeNight ? whDataNight : 0);
                    }, 0)}
                </div>
            `;

            document.getElementById('summaryTable').innerHTML = tableHtml;
            document.getElementById('summarySection').classList.remove('active');
            document.getElementById('summaryTableSection').classList.add('active');
            document.getElementById('currentSummaryDate').textContent = selectedSummaryDate;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è
        function updateSummaryTable() {
            showSummaryData();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º —Å–≤–æ–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
        function prevSummaryDay() {
            selectedSummaryDate = getDateOffset(-1);
            showSummaryData();
        }

        function nextSummaryDay() {
            selectedSummaryDate = getDateOffset(1);
            showSummaryData();
        }

        function getDateOffset(offset) {
            const date = new Date(selectedSummaryDate);
            date.setDate(date.getDate() + offset);
            return date.toLocaleDateString('ru-RU');
        }

        // –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function showPersonnelSummaryData() {
            if (!selectedSummaryDate) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ!');
                return;
            }
            const includeDay = document.getElementById('personnelSummaryDay').checked;
            const includeNight = document.getElementById('personnelSummaryNight').checked;
            const managerFilter = document.getElementById('personnelManagerFilter').value;

            if (!includeDay && !includeNight) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–º–µ–Ω—ã!');
                return;
            }

            const summaryDate = new Date(selectedSummaryDate);
            const tableData = [];

            PERSONNEL_OBJECTS.forEach(obj => {
                const objData = personnelReports[summaryDate.toLocaleDateString('ru-RU')]?.[obj] || {};

                // –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞
                if (includeDay) {
                    const dayData = objData.day || {};
                    const manager = dayData['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                    if (!managerFilter || manager === managerFilter) {
                        tableData.push({
                            type: 'day',
                            obj,
                            data: dayData
                        });
                    }
                }

                // –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞
                if (includeNight) {
                    const nightData = objData.night || {};
                    const manager = nightData['–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å']?.value || '';
                    if (!managerFilter || manager === managerFilter) {
                        tableData.push({
                            type: 'night',
                            obj,
                            data: nightData
                        });
                    }
                }
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML —Ç–∞–±–ª–∏—Ü—ã
            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>–û–±—ä–µ–∫—Ç</th>
                            <th>–¢–∏–ø —Å–º–µ–Ω—ã</th>
                            ${PERSONNEL_CATEGORIES.map(cat => `
                                <th>${cat.name}</th>
                            `).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${tableData.map(item => `
                            <tr>
                                <td>${item.obj}</td>
                                <td>${item.type === 'day' ? '‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è' : 'üåô –ù–æ—á–Ω–∞—è'}</td>
                                ${PERSONNEL_CATEGORIES.map(cat => {
                                    const data = item.data[cat.name] || {};
                                    if (cat.type === 'number') {
                                        return `
                                            <td>${data.plan || '-'}</td>
                                            <td>${data.fact || '-'}</td>
                                            <td class="${data.delta >= 0 ? 'positive' : 'negative'}">${data.delta || '-'}</td>
                                        `;
                                    } else if (cat.type === 'select') {
                                        return `<td>${data.value || '-'}</td>`;
                                    }
                                    return '<td>-</td>';
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            document.getElementById('personnelSummaryTable').innerHTML = tableHtml;
            document.getElementById('personnelSummarySection').classList.remove('active');
            document.getElementById('personnelSummaryTableSection').classList.add('active');
            document.getElementById('currentPersonnelSummaryDate').textContent = selectedSummaryDate;
        }

        function updatePersonnelSummaryTable() {
            showPersonnelSummaryData();
        }

        // –ü–æ–ª–Ω—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
        function toggleFullScreen() {
            const fs = document.getElementById('fullScreenTable');
            const mainTable = document.getElementById('summaryTable').innerHTML;
            fs.style.display = fs.style.display === 'none' ? 'block' : 'none';
            document.getElementById('fullSummaryTable').innerHTML = mainTable;
            document.body.style.overflow = fs.style.display === 'block' ? 'hidden' : 'auto';
        }

        // –ü–æ–ª–Ω—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
        function togglePersonnelFullScreen() {
            const fs = document.getElementById('psFullScreen');
            const mainTable = document.getElementById('personnelSummaryTable').innerHTML;
            fs.style.display = fs.style.display === 'none' ? 'block' : '