<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { 
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            padding: 30px 40px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        h1 { 
            color: #ffffff;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }
        
        h2 {
            color: #f1f5f9;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        h3 {
            color: #cbd5e1;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .section { 
            padding: 40px;
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section.active { display: block; }
        
        .warehouse-list { 
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .warehouse-btn { 
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
            color: #f8fafc;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            word-wrap: break-word;
            hyphens: auto;
        }
        
        .warehouse-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .warehouse-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .warehouse-btn:hover::before {
            left: 100%;
        }
        
        .warehouse-btn:active {
            transform: translateY(0);
        }
        
        label { 
            display: block;
            margin-top: 15px;
            margin-bottom: 6px;
            font-weight: 500;
            color: #cbd5e1;
            font-size: 13px;
        }
        
        input[type="text"] { 
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            background: rgba(30, 41, 59, 0.5);
            color: #f1f5f9;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        input[type="text"]:focus { 
            outline: none;
            border-color: #8b5cf6;
            background: rgba(30, 41, 59, 0.8);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        button { 
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: #ffffff;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #475569 0%, #64748b 100%);
        }
        
        button.date-btn { 
            background: rgba(51, 65, 85, 0.5);
            color: #cbd5e1;
            min-width: 42px;
            height: 42px;
            padding: 8px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            font-size: 13px;
            box-shadow: none;
        }
        
        button.date-btn:hover {
            background: rgba(71, 85, 105, 0.8);
            border-color: #8b5cf6;
        }
        
        button.date-btn.selected { 
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: #ffffff;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .radio-group, .checkbox-group { 
            display: flex;
            gap: 25px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
        }
        
        .radio-group label, .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin: 0;
        }
        
        .radio-group input[type="radio"], 
        .checkbox-group input[type="checkbox"] { 
            width: 18px;
            height: 18px;
            margin: 0;
            accent-color: #8b5cf6;
            cursor: pointer;
        }
        
        .calendar { 
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin: 15px 0;
            max-width: 350px;
            background: rgba(30, 41, 59, 0.3);
            padding: 15px;
            border-radius: 12px;
        }
        
        .calendar-header { 
            text-align: center;
            font-weight: 600;
            padding: 10px;
            background: rgba(99, 102, 241, 0.1);
            color: #c7d2fe;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .calendar .empty { 
            visibility: hidden;
        }
        
        .calendar-controls { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .category-input {
            background: rgba(30, 41, 59, 0.3);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .category-input h4 {
            color: #a5b4fc;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .delta-display {
            padding: 8px 12px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            margin-top: 10px;
        }
        
        table { 
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            background: rgba(15, 23, 42, 0.5);
            font-size: 10px;
            table-layout: fixed;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table-wrapper {
            max-width: 100%;
            margin-top: 20px;
            overflow-x: visible;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        th, td { 
            border: 1px solid rgba(71, 85, 105, 0.3);
            padding: 6px 4px;
            text-align: center;
            color: #cbd5e1;
            white-space: nowrap;
            font-size: 9px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        th {
            font-size: 8px;
            line-height: 1.2;
            padding: 5px 2px;
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            position: sticky;
            top: 0;
            color: #e0e7ff;
            font-weight: 600;
            z-index: 10;
        }
        
        td:first-child, th:first-child {
            width: 70px;
        }
        
        td:nth-child(2), th:nth-child(2) {
            width: 120px;
            font-size: 8px;
        }
        
        td:nth-child(3), th:nth-child(3) {
            width: 30px;
        }
        
        tbody tr {
            transition: background 0.15s ease;
        }
        
        tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }
        
        .positive { 
            color: #34d399;
            font-weight: 600;
        }
        
        .negative { 
            color: #f87171;
            font-weight: 600;
        }
        
        .summary-total {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #e0e7ff;
        }
        
        .full-screen-table { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(15, 23, 42, 0.98);
            z-index: 1000;
            overflow: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .close-full { 
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1001;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        
        .close-full:hover {
            transform: scale(1.05);
        }
        
        .date-section {
            background: rgba(30, 41, 59, 0.2);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .selected-date-display {
            background: rgba(99, 102, 241, 0.1);
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            color: #c7d2fe;
            font-weight: 500;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .large-button {
            width: 100%;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            box-shadow: 0 10px 25px -5px rgba(5, 150, 105, 0.4);
        }
        
        .large-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(5, 150, 105, 0.5);
        }
        
        /* –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä */
        .test-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(139, 92, 246, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 999;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        
        /* –ö–æ–Ω—Å–æ–ª—å –≤ –Ω–∏–∑—É */
        #console-output {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            max-width: 45%;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            padding: 8px 16px;
            font-size: 11px;
            color: #94a3b8;
            font-family: 'Courier New', monospace;
            z-index: 998;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            pointer-events: none;
            max-height: 40px;
            overflow: hidden;
        }
        
        #console-output::before {
            content: '‚öôÔ∏è ';
            color: #8b5cf6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h1>
            <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</div>
        </div>
        
        <!-- –ì–ª–∞–≤–Ω–∞—è: –°–ø–∏—Å–æ–∫ —Å–∫–ª–∞–¥–æ–≤ -->
        <div id="mainSection" class="section active">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥</h2>
            <div class="warehouse-list" id="warehouseList"></div>
            <button class="large-button" onclick="showSummarySection()">üìä –û–±—â–∏–π —Å–≤–æ–¥ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º</button>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ —Å–∫–ª–∞–¥—É -->
        <div id="warehouseReportSection" class="section">
            <h2 id="warehouseTitle">–û—Ç—á—ë—Ç –ø–æ —Å–∫–ª–∞–¥—É</h2>
            
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriod()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarView()">
                        <span id="warehouseViewToggleText">üìÜ –ú–µ—Å—è—Ü</span>
                    </button>
                    <button class="secondary" onclick="nextPeriod()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="warehouseCalendar" class="calendar"></div>
                <div id="selectedWarehouseDate" class="selected-date-display"></div>
            </div>
            
            <div class="radio-group">
                <label><input type="radio" name="warehouseReportType" value="day" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞</label>
                <label><input type="radio" name="warehouseReportType" value="night"> üåô –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞</label>
            </div>
            
            <form id="reportForm">
                <div id="categoryInputs"></div>
                <div class="action-buttons">
                    <button type="button" onclick="saveWarehouseReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
                    <button type="button" class="secondary" onclick="showMainSection()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–∫–ª–∞–¥–∞–º</button>
                </div>
            </form>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –æ–±—â–µ–≥–æ —Å–≤–æ–¥–∞ -->
        <div id="summarySection" class="section">
            <h2>üìä –û–±—â–∏–π —Å–≤–æ–¥ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º</h2>
            
            <div class="checkbox-group">
                <label><input type="checkbox" id="summaryDay" checked> ‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã–µ —Å–º–µ–Ω—ã</label>
                <label><input type="checkbox" id="summaryNight"> üåô –ù–æ—á–Ω—ã–µ —Å–º–µ–Ω—ã</label>
            </div>
            
            <div class="date-section">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
                <div class="calendar-controls">
                    <button class="secondary" onclick="prevPeriodSummary()">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π</button>
                    <button class="secondary" onclick="toggleCalendarViewSummary()">
                        <span id="summaryViewToggleText">üìÜ –ú–µ—Å—è—Ü</span>
                    </button>
                    <button class="secondary" onclick="nextPeriodSummary()">–°–ª–µ–¥—É—é—â–∏–π ‚Üí</button>
                </div>
                <div id="summaryCalendar" class="calendar"></div>
            </div>
            
            <div class="action-buttons">
                <button onclick="showSummaryData()">üìà –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="secondary" onclick="showMainSection()">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–∫–ª–∞–¥–∞–º</button>
            </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–≤–æ–¥–∞ -->
        <div id="summaryTableSection" class="section">
            <h2>üìã –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
            <div id="summaryTable"></div>
            <div class="action-buttons">
                <button onclick="toggleFullScreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
                <button class="secondary" onclick="showSummarySection()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>
    
    <!-- Full-screen —Ç–∞–±–ª–∏—Ü–∞ -->
    <div id="fullScreenTable" class="full-screen-table" style="display: none;">
        <button class="close-full" onclick="toggleFullScreen()">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        <div id="fullSummaryTable"></div>
    </div>
    
    <!-- –ö–æ–Ω—Å–æ–ª—å –≤–Ω–∏–∑—É -->
    <div id="console-output"></div>

    <script>
        // –°–∫–ª–∞–¥—ã
        const WAREHOUSES = [
            "–ê–†–•–ê–ù–ì–ï–õ–¨–°–ö_–•–ê–ë_–ù–ê–•–ò–ú–û–í–ê",
            "–ú–£–†–ú–ê–ù–°–ö_–•–ê–ë_–û–ë–™–ï–ó–î–ù–ê–Ø",
            "–í–ï–õ–ò–ö–ò–ô_–ù–û–í–ì–û–†–û–î_–•–ê–ë_–ù–ï–•–ò–ù–°–ö–ê–Ø",
            "–ü–ï–¢–†–û–ó–ê–í–û–î–°–ö_–•–ê–ë_–ü–†–Ø–ñ–ò–ù–°–ö–û–ï",
            "–ü–°–ö–û–í_–•–ê–ë_–ú–ê–†–ì–ï–õ–û–í–ê",
            "–ü–°–ö–û–í_–•–ê–ë_–ù–û–í–´–ô",
            "–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–õ–ï–°–û–ü–ê–†–ö–û–í–ê–Ø",
            "–°–´–ö–¢–´–í–ö–ê–†_–•–ê–ë_–û–ö–¢–Ø–ë–†–¨–°–ö–ò–ô",
            "–ß–ï–†–ï–ü–û–í–ï–¶_–•–ê–ë_–°–¢–†–û–ô–ò–ù–î–£–°–¢–†–ò–ò",
            "–í–û–õ–û–ì–î–ê_–•–ê–ë_–ë–ï–õ–û–ó–ï–†–°–ö–û–ï"
        ];
        
        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        const CATEGORIES = [
            {name: '–û–±—ä–µ–º', type: 'number'},
            {name: '–ü–µ—Ä—Å–æ–Ω–∞–ª', type: 'number'},
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞ –§–ë–°', type: 'time'},
            {name: '–í–æ–∑–≤—Ä–∞—Ç –ø–æ—á—Ç—ã', type: 'number'},
            {name: '–û–±—Ä–∞–±–æ—Ç–∫–∞', type: 'number'},
            {name: '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', type: 'number'},
            {name: '–ö–æ-–≤ –æ—Ç—Ä', type: 'number'},
            {name: '–§–¢–°', type: 'number'}
        ];
        
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ
        let reports = JSON.parse(localStorage.getItem('warehouseReports')) || {};
        let currentDate = new Date();
        let warehouseCalendarView = 'week';
        let summaryCalendarView = 'week';
        let selectedWarehouseDate = null;
        let selectedSummaryDate = null;
        let currentWarehouse = '';
        
        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ (—Å—Ç–∞—Ä—à–µ 6 –º–µ—Å—è—Ü–µ–≤)
        function cleanOldReports() {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            const keysToDelete = [];
            Object.keys(reports).forEach(dateStr => {
                try {
                    const [day, month, year] = dateStr.split('.').map(Number);
                    const reportDate = new Date(year, month - 1, day);
                    if (reportDate < sixMonthsAgo) {
                        keysToDelete.push(dateStr);
                    }
                } catch (e) {
                    keysToDelete.push(dateStr);
                }
            });
            keysToDelete.forEach(key => delete reports[key]);
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
        }
        
        // –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –¢–ï–°–¢–û–í–´–• –î–ê–ù–ù–´–•
        function fillTestData() {
            const today = new Date();
            const testDates = [];
            
            // –°–æ–∑–¥–∞–µ–º 5 –¥–∞—Ç: —Å–µ–≥–æ–¥–Ω—è –∏ 4 –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–Ω—è
            for (let i = 0; i < 5; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                testDates.push(date.toLocaleDateString('ru-RU'));
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º 3 —Å–∫–ª–∞–¥–∞ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            const testWarehouses = [
                "–í–ï–õ–ò–ö–ò–ô_–ù–û–í–ì–û–†–û–î_–•–ê–ë_–ù–ï–•–ò–ù–°–ö–ê–Ø",
                "–ü–°–ö–û–í_–•–ê–ë_–ù–û–í–´–ô",
                "–í–û–õ–û–ì–î–ê_–•–ê–ë_–ë–ï–õ–û–ó–ï–†–°–ö–û–ï"
            ];
            
            testDates.forEach(dateStr => {
                if (!reports[dateStr]) reports[dateStr] = {};
                
                testWarehouses.forEach((wh, whIndex) => {
                    if (!reports[dateStr][wh]) reports[dateStr][wh] = {};
                    
                    // –î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞
                    reports[dateStr][wh].day = {
                        '–û–±—ä–µ–º': {
                            plan: String(100 + whIndex * 20),
                            fact: String(95 + whIndex * 22),
                            delta: (95 + whIndex * 22) - (100 + whIndex * 20)
                        },
                        '–ü–µ—Ä—Å–æ–Ω–∞–ª': {
                            plan: String(15 + whIndex),
                            fact: String(15 + whIndex),
                            delta: 0
                        },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞ –§–ë–°': {
                            plan: String(12 + whIndex),
                            fact: String(11 + whIndex),
                            delta: (11 + whIndex) - (12 + whIndex)
                        },
                        '–í–æ–∑–≤—Ä–∞—Ç –ø–æ—á—Ç—ã': {
                            plan: String(5),
                            fact: String(7),
                            delta: 2
                        },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞': {
                            plan: String(200 + whIndex * 30),
                            fact: String(210 + whIndex * 30),
                            delta: 10
                        },
                        '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ': {
                            plan: '',
                            fact: String(2 + whIndex),
                            delta: ''
                        },
                        '–ö–æ-–≤ –æ—Ç—Ä': {
                            plan: '',
                            fact: String(1),
                            delta: ''
                        },
                        '–§–¢–°': {
                            plan: '',
                            fact: String(3 + whIndex),
                            delta: ''
                        }
                    };
                    
                    // –ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞ (–º–µ–Ω—å—à–µ –æ–±—ä–µ–º)
                    reports[dateStr][wh].night = {
                        '–û–±—ä–µ–º': {
                            plan: String(50 + whIndex * 10),
                            fact: String(48 + whIndex * 11),
                            delta: (48 + whIndex * 11) - (50 + whIndex * 10)
                        },
                        '–ü–µ—Ä—Å–æ–Ω–∞–ª': {
                            plan: String(8 + whIndex),
                            fact: String(8 + whIndex),
                            delta: 0
                        },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞ –§–ë–°': {
                            plan: String(15),
                            fact: String(14),
                            delta: -1
                        },
                        '–í–æ–∑–≤—Ä–∞—Ç –ø–æ—á—Ç—ã': {
                            plan: String(3),
                            fact: String(4),
                            delta: 1
                        },
                        '–û–±—Ä–∞–±–æ—Ç–∫–∞': {
                            plan: String(100 + whIndex * 15),
                            fact: String(105 + whIndex * 15),
                            delta: 5
                        },
                        '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ': {
                            plan: '',
                            fact: String(1),
                            delta: ''
                        },
                        '–ö–æ-–≤ –æ—Ç—Ä': {
                            plan: '',
                            fact: String(0),
                            delta: ''
                        },
                        '–§–¢–°': {
                            plan: '',
                            fact: String(2),
                            delta: ''
                        }
                    };
                });
            });
            
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            alert(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\n\nüì¶ –°–∫–ª–∞–¥—ã: ${testWarehouses.length}\nüìÖ –î–∞—Ç: ${testDates.length}\nüî¢ –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${testWarehouses.length * testDates.length * 2} (–¥–µ–Ω—å + –Ω–æ—á—å)`);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            cleanOldReports();
            generateWarehouseList();
            renderWarehouseCalendar();
            renderSummaryCalendar();
        };
        
        function generateWarehouseList() {
            const list = document.getElementById('warehouseList');
            list.innerHTML = '';
            WAREHOUSES.forEach(wh => {
                const btn = document.createElement('button');
                btn.className = 'warehouse-btn';
                btn.textContent = wh;
                btn.onclick = () => showWarehouseReport(wh);
                list.appendChild(btn);
            });
        }
        
        function showWarehouseReport(warehouse) {
            currentWarehouse = warehouse;
            document.getElementById('warehouseTitle').textContent = `üìç ${warehouse}`;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('warehouseReportSection').classList.add('active');
            selectedWarehouseDate = currentDate.toLocaleDateString('ru-RU');
            document.getElementById('selectedWarehouseDate').innerHTML = `<strong>–í—ã–±—Ä–∞–Ω–æ:</strong> ${selectedWarehouseDate}`;
            renderWarehouseCalendar();
            loadCategoryInputs();
        }
        
        function renderCalendar(calendarId, view, onDateSelect, selectedDateStr) {
            const calendarDiv = document.getElementById(calendarId);
            calendarDiv.innerHTML = '';
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendarDiv.appendChild(header);
            });
            
            let dates = [];
            if (view === 'week') {
                const monday = new Date(currentDate);
                const dayOfWeek = monday.getDay();
                monday.setDate(monday.getDate() - (dayOfWeek || 7) + 1);
                for (let i = 0; i < 7; i++) {
                    const d = new Date(monday);
                    d.setDate(monday.getDate() + i);
                    dates.push({date: d, day: d.getDate(), empty: false});
                }
            } else {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDay = firstDay.getDay() || 7;
                
                for (let i = 0; i < startDay - 1; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'date-btn empty';
                    btn.textContent = '';
                    calendarDiv.appendChild(btn);
                }
                
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const d = new Date(year, month, day);
                    dates.push({date: d, day: day, empty: false});
                }
            }
            
            dates.forEach(dateObj => {
                const btn = document.createElement('button');
                btn.className = 'date-btn';
                btn.textContent = dateObj.day;
                if (dateObj.date.toLocaleDateString('ru-RU') === selectedDateStr) {
                    btn.classList.add('selected');
                }
                btn.onclick = () => onDateSelect(dateObj.date);
                calendarDiv.appendChild(btn);
            });
        }
        
        function renderWarehouseCalendar() {
            renderCalendar('warehouseCalendar', warehouseCalendarView, selectWarehouseDate, selectedWarehouseDate);
        }
        
        function renderSummaryCalendar() {
            renderCalendar('summaryCalendar', summaryCalendarView, selectSummaryDate, selectedSummaryDate || currentDate.toLocaleDateString('ru-RU'));
        }
        
        function selectWarehouseDate(date) {
            selectedWarehouseDate = date.toLocaleDateString('ru-RU');
            document.getElementById('selectedWarehouseDate').innerHTML = `<strong>–í—ã–±—Ä–∞–Ω–æ:</strong> ${selectedWarehouseDate}`;
            renderWarehouseCalendar();
            loadCategoryInputs();
        }
        
        function selectSummaryDate(date) {
            selectedSummaryDate = date.toLocaleDateString('ru-RU');
            renderSummaryCalendar();
        }
        
        function prevPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderWarehouseCalendar();
        }
        
        function nextPeriod() {
            if (warehouseCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderWarehouseCalendar();
        }
        
        function toggleCalendarView() {
            warehouseCalendarView = warehouseCalendarView === 'week' ? 'month' : 'week';
            document.getElementById('warehouseViewToggleText').textContent = warehouseCalendarView === 'week' ? 'üìÜ –ú–µ—Å—è—Ü' : 'üìÖ –ù–µ–¥–µ–ª—è';
            renderWarehouseCalendar();
        }
        
        function prevPeriodSummary() {
            if (summaryCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() - 1);
            }
            renderSummaryCalendar();
        }
        
        function nextPeriodSummary() {
            if (summaryCalendarView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else {
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            renderSummaryCalendar();
        }
        
        function toggleCalendarViewSummary() {
            summaryCalendarView = summaryCalendarView === 'week' ? 'month' : 'week';
            document.getElementById('summaryViewToggleText').textContent = summaryCalendarView === 'week' ? 'üìÜ –ú–µ—Å—è—Ü' : 'üìÖ –ù–µ–¥–µ–ª—è';
            renderSummaryCalendar();
        }
        
        function loadCategoryInputs() {
            if (!selectedWarehouseDate) return;
            const selectedType = document.querySelector('input[name="warehouseReportType"]:checked').value;
            const inputsDiv = document.getElementById('categoryInputs');
            inputsDiv.innerHTML = '';
            
            CATEGORIES.forEach(cat => {
                const catDiv = document.createElement('div');
                catDiv.className = 'category-input';
                
                const data = reports[selectedWarehouseDate]?.[currentWarehouse]?.[selectedType]?.[cat.name] || {};
                
                catDiv.innerHTML = `
                    <h4>${cat.name}</h4>
                    <div class="input-row">
                        <div>
                            <label>–ü–ª–∞–Ω:</label>
                            <input type="text" id="${currentWarehouse}_${selectedType}_${cat.name}_plan" 
                                   placeholder="${cat.type === 'time' ? '–ú–∏–Ω—É—Ç—ã –∏–ª–∏ HH:MM' : '–ü–ª–∞–Ω'}" 
                                   ${cat.type === 'time' ? '' : 'inputmode="numeric"'}
                                   value="${data.plan || ''}">
                        </div>
                        <div>
                            <label>–§–∞–∫—Ç:</label>
                            <input type="text" id="${currentWarehouse}_${selectedType}_${cat.name}_fact" 
                                   placeholder="${cat.type === 'time' ? '–ú–∏–Ω—É—Ç—ã –∏–ª–∏ HH:MM' : '–§–∞–∫—Ç'}" 
                                   ${cat.type === 'time' ? '' : 'inputmode="numeric"'}
                                   value="${data.fact || ''}">
                        </div>
                    </div>
                    <div class="delta-display">
                        –î–µ–ª—å—Ç–∞: <span id="${currentWarehouse}_${selectedType}_${cat.name}_delta"></span>
                    </div>
                `;
                inputsDiv.appendChild(catDiv);
                
                const planInput = document.getElementById(`${currentWarehouse}_${selectedType}_${cat.name}_plan`);
                const factInput = document.getElementById(`${currentWarehouse}_${selectedType}_${cat.name}_fact`);
                
                updateDelta(currentWarehouse, selectedType, cat.name);
                
                planInput.addEventListener('input', () => updateDelta(currentWarehouse, selectedType, cat.name));
                factInput.addEventListener('input', () => updateDelta(currentWarehouse, selectedType, cat.name));
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="warehouseReportType"]').forEach(radio => {
                radio.addEventListener('change', loadCategoryInputs);
            });
        });
        
        function updateDelta(wh, type, catName) {
            const planInput = document.getElementById(`${wh}_${type}_${catName}_plan`);
            const factInput = document.getElementById(`${wh}_${type}_${catName}_fact`);
            const deltaSpan = document.getElementById(`${wh}_${type}_${catName}_delta`);
            if (!planInput || !factInput || !deltaSpan) return;
            const cat = CATEGORIES.find(c => c.name === catName);
            const plan = planInput.value.trim();
            const fact = factInput.value.trim();
            let delta = '';
            if (cat.type === 'number') {
                const p = parseInt(plan) || 0;
                const f = parseInt(fact) || 0;
                delta = f - p;
                deltaSpan.textContent = delta;
                deltaSpan.className = delta >= 0 ? 'positive' : 'negative';
            } else if (cat.type === 'time') {
                if (plan && fact) {
                    if (!plan.includes(':') && !fact.includes(':')) {
                        const p = parseInt(plan) || 0;
                        const f = parseInt(fact) || 0;
                        delta = f - p;
                        deltaSpan.textContent = delta;
                        deltaSpan.className = delta === 0 ? 'positive' : (delta < 0 ? 'positive' : 'negative');
                    } else {
                        const pMin = parseTimeToMin(plan);
                        const fMin = parseTimeToMin(fact);
                        if (!isNaN(pMin) && !isNaN(fMin)) {
                            delta = fMin - pMin;
                            deltaSpan.textContent = delta;
                            deltaSpan.className = delta <= 0 ? 'positive' : 'negative';
                        } else {
                            deltaSpan.textContent = '–û—à–∏–±–∫–∞';
                            deltaSpan.className = 'negative';
                        }
                    }
                } else {
                    deltaSpan.textContent = '';
                }
            }
        }
        
        function parseTimeToMin(timeStr) {
            const parts = timeStr.split(':');
            if (parts.length !== 2) return NaN;
            const h = parseInt(parts[0]) || 0;
            const m = parseInt(parts[1]) || 0;
            return h * 60 + m;
        }
        
        function saveWarehouseReport() {
            if (!selectedWarehouseDate) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É!');
            const selectedType = document.querySelector('input[name="warehouseReportType"]:checked').value;
            if (!reports[selectedWarehouseDate]) reports[selectedWarehouseDate] = {};
            if (!reports[selectedWarehouseDate][currentWarehouse]) reports[selectedWarehouseDate][currentWarehouse] = {};
            if (!reports[selectedWarehouseDate][currentWarehouse][selectedType]) reports[selectedWarehouseDate][currentWarehouse][selectedType] = {};
            CATEGORIES.forEach(cat => {
                const plan = document.getElementById(`${currentWarehouse}_${selectedType}_${cat.name}_plan`).value.trim();
                const fact = document.getElementById(`${currentWarehouse}_${selectedType}_${cat.name}_fact`).value.trim();
                let delta = '';
                if (cat.type === 'number') {
                    const p = parseInt(plan) || 0;
                    const f = parseInt(fact) || 0;
                    delta = f - p;
                } else if (cat.type === 'time') {
                    if (plan && fact) {
                        if (!plan.includes(':') && !fact.includes(':')) {
                            const p = parseInt(plan) || 0;
                            const f = parseInt(fact) || 0;
                            delta = f - p;
                        } else {
                            const pMin = parseTimeToMin(plan);
                            const fMin = parseTimeToMin(fact);
                            if (!isNaN(pMin) && !isNaN(fMin)) {
                                delta = fMin - pMin;
                            }
                        }
                    }
                }
                reports[selectedWarehouseDate][currentWarehouse][selectedType][cat.name] = { plan, fact, delta };
            });
            localStorage.setItem('warehouseReports', JSON.stringify(reports));
            cleanOldReports();
            alert('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –æ–±—â–µ–º —Å–≤–æ–¥–µ.');
            showMainSection();
        }
        
        function showSummarySection() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('summarySection').classList.add('active');
            selectedSummaryDate = currentDate.toLocaleDateString('ru-RU');
            renderSummaryCalendar();
        }
        
        function showMainSection() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('mainSection').classList.add('active');
        }
        
        function showSummaryData() {
            if (!selectedSummaryDate) {
                alert('‚ö†Ô∏è –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –¥–∞—Ç—É –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ!');
                return;
            }
            const includeDay = document.getElementById('summaryDay').checked;
            const includeNight = document.getElementById('summaryNight').checked;
            if (!includeDay && !includeNight) return alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø –æ—Ç—á—ë—Ç–∞!');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
            const consoleDiv = document.getElementById('console-output');
            if (consoleDiv) {
                consoleDiv.textContent = `–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤–æ–¥–∞ –¥–ª—è: ${selectedSummaryDate}`;
                setTimeout(() => {
                    consoleDiv.textContent = '';
                }, 3000);
            }
            
            document.getElementById('summarySection').classList.remove('active');
            document.getElementById('summaryTableSection').classList.add('active');
            
            const tableDiv = document.getElementById('summaryTable');
            let html = '<table><thead><tr><th>–î–∞—Ç–∞</th><th>–°–∫–ª–∞–¥</th><th>–•–ê</th>';
            CATEGORIES.forEach(cat => {
                if (['–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '–ö–æ-–≤ –æ—Ç—Ä', '–§–¢–°'].includes(cat.name)) {
                    html += `<th>${cat.name}</th>`;
                } else {
                    html += `<th>–ü</th><th>–§</th><th>Œî</th>`;
                }
            });
            html += '<th>–¢–∏–ø</th></tr>';
            
            html += '<tr style="background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);">';
            html += '<th colspan="3">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí</th>';
            CATEGORIES.forEach(cat => {
                if (['–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '–ö–æ-–≤ –æ—Ç—Ä', '–§–¢–°'].includes(cat.name)) {
                    // –ø—Ä–æ–ø—É—Å–∫
                } else {
                    const shortName = cat.name === '–û–±—ä–µ–º' ? '–û–±–º' : 
                                    cat.name === '–ü–µ—Ä—Å–æ–Ω–∞–ª' ? '–ü–µ—Ä—Å' : 
                                    cat.name === '–û–±—Ä–∞–±–æ—Ç–∫–∞ –§–ë–°' ? '–§–ë–°' : 
                                    cat.name === '–í–æ–∑–≤—Ä–∞—Ç –ø–æ—á—Ç—ã' ? '–í–æ–∑–≤' : 
                                    cat.name === '–û–±—Ä–∞–±–æ—Ç–∫–∞' ? '–û–±—Ä' : cat.name;
                    html += `<th colspan="3">${shortName}</th>`;
                }
            });
            CATEGORIES.forEach(cat => {
                if (['–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '–ö–æ-–≤ –æ—Ç—Ä', '–§–¢–°'].includes(cat.name)) {
                    const shortName = cat.name === '–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ' ? '–≠–∫—Å' : 
                                    cat.name === '–ö–æ-–≤ –æ—Ç—Ä' ? '–ö–≤–û' : 
                                    cat.name === '–§–¢–°' ? '–§–¢–°' : cat.name;
                    html += `<th>${shortName}</th>`;
                }
            });
            html += '<th></th></tr></thead><tbody>';
            
            let totalVolumePlan = 0;
            const warehouseData = reports[selectedSummaryDate] || {};
            
            WAREHOUSES.forEach(wh => {
                const whData = warehouseData[wh] || {};
                let rowAdded = false;
                if (includeDay && whData.day) {
                    const rowData = addRow(selectedSummaryDate, wh, whData.day, '‚òÄÔ∏è –î–µ–Ω—å');
                    html += rowData.html;
                    totalVolumePlan += rowData.volumePlan;
                    rowAdded = true;
                }
                if (includeNight && whData.night) {
                    const rowData = addRow(selectedSummaryDate, wh, whData.night, 'üåô –ù–æ—á—å');
                    html += rowData.html;
                    totalVolumePlan += rowData.volumePlan;
                    rowAdded = true;
                }
                if (!rowAdded) {
                    let cells = `<td>${selectedSummaryDate}</td><td>${wh}</td><td>–•–ê</td>`;
                    const numCols = CATEGORIES.reduce((acc, cat) => acc + (['–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '–ö–æ-–≤ –æ—Ç—Ä', '–§–¢–°'].includes(cat.name) ? 1 : 3), 0);
                    for (let i = 0; i < numCols; i++) cells += '<td>-</td>';
                    cells += '<td>-</td>';
                    html += `<tr>${cells}</tr>`;
                }
            });
            
            html += '</tbody></table>';
            tableDiv.innerHTML = '<div class="table-wrapper">' + html + '</div><div class="summary-total">üìä –ò—Ç–æ–≥–æ –ø–æ –û–±—ä—ë–º—É (–ø–ª–∞–Ω): ' + totalVolumePlan + '</div>';
        }
        
        function addRow(date, wh, typeData, typeLabel) {
            let html = `<tr><td>${date}</td><td>${wh}</td><td>–•–ê</td>`;
            let volumePlan = 0;
            
            CATEGORIES.forEach(cat => {
                const data = typeData[cat.name] || {};
                if (['–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ', '–ö–æ-–≤ –æ—Ç—Ä', '–§–¢–°'].includes(cat.name)) {
                    html += `<td>${data.fact || 0}</td>`;
                } else {
                    html += `<td>${data.plan || ''}</td><td>${data.fact || ''}</td>`;
                    const deltaCell = data.delta !== undefined && data.delta !== '' ? data.delta : '';
                    const deltaClass = typeof deltaCell === 'number' ? (deltaCell >= 0 ? 'positive' : 'negative') : '';
                    html += `<td class="${deltaClass}">${deltaCell}</td>`;
                    if (cat.name === '–û–±—ä–µ–º') {
                        volumePlan = parseInt(data.plan) || 0;
                    }
                }
            });
            html += `<td>${typeLabel}</td></tr>`;
            
            return { html, volumePlan };
        }
        
        function toggleFullScreen() {
            const full = document.getElementById('fullScreenTable');
            const table = document.getElementById('summaryTable');
            if (full.style.display === 'none') {
                document.getElementById('fullSummaryTable').innerHTML = table.innerHTML;
                full.style.display = 'block';
                document.body.style.overflow = 'hidden';
            } else {
                full.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
    </script>
</body>
</html>
